var e,t;"function"==typeof(e=globalThis.define)&&(t=e,e=null),function(t,r,s,n,i){var o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},a="function"==typeof o[n]&&o[n],l=a.cache||{},u="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function c(e,r){if(!l[e]){if(!t[e]){var s="function"==typeof o[n]&&o[n];if(!r&&s)return s(e,!0);if(a)return a(e,!0);if(u&&"string"==typeof e)return u(e);var i=Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}d.resolve=function(r){var s=t[e][1][r];return null!=s?s:r},d.cache={};var h=l[e]=new c.Module(e);t[e][0].call(h.exports,d,h,h.exports,this)}return l[e].exports;function d(e){var t=d.resolve(e);return!1===t?{}:c(t)}}c.isParcelRequire=!0,c.Module=function(e){this.id=e,this.bundle=c,this.exports={}},c.modules=t,c.cache=l,c.parent=a,c.register=function(e,r){t[e]=[function(e,t){t.exports=r},{}]},Object.defineProperty(c,"root",{get:function(){return o[n]}}),o[n]=c;for(var h=0;h<r.length;h++)c(r[h]);if(s){var d=c(s);"object"==typeof exports&&"undefined"!=typeof module?module.exports=d:"function"==typeof e&&e.amd?e(function(){return d}):i&&(this[i]=d)}}({kgW6q:[function(e,t,r){e("../../../src/background")},{"../../../src/background":"fx8Od"}],fx8Od:[function(e,t,r){var s=e("@plasmohq/storage"),n=e("convex/browser"),i=e("../convex/_generated/api");let o=new s.Storage,a="https://insightful-flamingo-560.convex.cloud",l="price_1Sn2VYRW1CkBuCyAtpyz4kwK",u=new n.ConvexHttpClient(a);async function c(e,t,r){try{switch(e.type){case"GET_AUTH_STATE":{let e=await o.get("isAuthenticated"),t=await o.get("odch123");r({isAuthenticated:e??!1,odch123:t});break}case"SET_AUTH_STATE":if(await o.set("isAuthenticated",e.payload.isAuthenticated),e.payload.odch123&&await o.set("odch123",e.payload.odch123),e.payload.isAuthenticated&&e.payload.odch123&&e.payload.email)try{await u.mutation(i.api.profiles.create,{odch123:e.payload.odch123,email:e.payload.email})}catch(e){console.log("[Instagram AI Optimizer] Profile may already exist")}r({success:!0});break;case"GET_CREDITS":{let e=await o.get("odch123");if(e&&a)try{let t=await u.query(i.api.profiles.getByUserId,{odch123:e});if(t){await o.set("credits",t.credits),await o.set("isPremium",t.isPremium),r({credits:t.isPremium?-1:t.credits});break}}catch(e){console.error("[Instagram AI Optimizer] Failed to fetch profile:",e)}let t=await o.get("credits");r({credits:t??1});break}case"SET_CREDITS":await o.set("credits",e.payload),r({success:!0});break;case"DECREMENT_CREDITS":{let e=await o.get("odch123");if(e&&a)try{let t=await u.mutation(i.api.profiles.decrementCredits,{odch123:e});await o.set("credits",t.credits),r(t);break}catch(e){console.error("[Instagram AI Optimizer] Failed to decrement credits:",e)}let t=await o.get("credits")??1,s=await o.get("isPremium");if(s)r({credits:-1});else if(t>0){let e=t-1;await o.set("credits",e),r({credits:e})}else r({credits:0,error:"No credits remaining"});break}case"SET_PREMIUM":{let t=await o.get("odch123");if(t&&a)try{await u.mutation(i.api.profiles.setPremium,{odch123:t,isPremium:e.payload})}catch(e){console.error("[Instagram AI Optimizer] Failed to set premium:",e)}await o.set("isPremium",e.payload),e.payload&&await o.set("credits",-1),r({success:!0});break}case"GET_USER_STATE":{let e=await o.get("odch123");if(e&&a)try{let t=await u.query(i.api.profiles.getByUserId,{odch123:e});if(t){await o.set("credits",t.credits),await o.set("isPremium",t.isPremium),r({isAuthenticated:!0,isPremium:t.isPremium,credits:t.isPremium?-1:t.credits,odch123:e});break}}catch(e){console.error("[Instagram AI Optimizer] Failed to fetch user state:",e)}let[t,s,n]=await Promise.all([o.get("isAuthenticated"),o.get("isPremium"),o.get("credits")]);r({isAuthenticated:t??!1,isPremium:s??!1,credits:s?-1:n??1,odch123:e});break}case"OPTIMIZE_IMAGE":if(a)try{let t=await u.action(i.api.ai.enhance.enhanceImage,{imageUrl:e.payload.imageUrl,stylePreset:e.payload.stylePreset,enhancementLevel:"moderate",useFullPipeline:!1});r({success:t.success,aiImageUrl:t.enhancedUrl||e.payload.imageUrl,error:t.error,processingTimeMs:t.processingTimeMs});break}catch(t){console.error("[Instagram AI Optimizer] AI enhancement failed:",t),r({success:!1,aiImageUrl:e.payload.imageUrl,error:String(t)});break}r({success:!1,aiImageUrl:e.payload.imageUrl,error:"Convex not configured"});break;case"CREATE_CHECKOUT":{let e=await o.get("odch123");if(!e){r({error:"Not authenticated"});break}if(a&&l)try{let t=await u.action(i.api.stripe.createCheckoutSession,{odch123:e,priceId:l,successUrl:"https://www.instagram.com/?payment=success",cancelUrl:"https://www.instagram.com/?payment=cancelled"});r(t);break}catch(e){console.error("[Instagram AI Optimizer] Failed to create checkout:",e),r({error:String(e)});break}r({error:"Stripe not configured"});break}default:r({error:"Unknown message type"})}}catch(e){console.error("[Instagram AI Optimizer] Message handling error:",e),r({error:String(e)})}}chrome.runtime.onInstalled.addListener(async e=>{"install"===e.reason&&(await o.set("credits",1),await o.set("isPremium",!1),await o.set("isAuthenticated",!1),console.log("[Instagram AI Optimizer] Extension installed"))}),chrome.action.onClicked.addListener(e=>{e.url?.includes("instagram.com")&&chrome.tabs.sendMessage(e.id,{type:"TOGGLE_PANEL"})}),chrome.runtime.onMessage.addListener((e,t,r)=>(c(e,t,r),!0)),chrome.tabs.onUpdated.addListener((e,t,r)=>{if("complete"===t.status&&r.url?.includes("instagram.com")){let t=new URL(r.url);"success"===t.searchParams.get("payment")&&(o.set("isPremium",!0),o.set("credits",-1),chrome.tabs.sendMessage(e,{type:"PAYMENT_SUCCESS"}).catch(()=>{})),chrome.tabs.sendMessage(e,{type:"PAGE_LOADED"}).catch(()=>{})}})},{"@plasmohq/storage":"3wfAg","convex/browser":"bKOGH","../convex/_generated/api":"ekwfn"}],"3wfAg":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"BaseStorage",()=>a),s.export(r,"Storage",()=>l);var n=e("pify"),i=s.interopDefault(n),o=()=>{try{let e=globalThis.navigator?.userAgent.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if("Chrome"===e[1])return 100>parseInt(e[2])||globalThis.chrome.runtime?.getManifest()?.manifest_version===2}catch{}return!1},a=class{#e;#t;get primaryClient(){return this.#t}#r;get secondaryClient(){return this.#r}#s;get area(){return this.#s}get hasWebApi(){try{return"u">typeof window&&!!window.localStorage}catch(e){return console.error(e),!1}}#n=new Map;#i;get copiedKeySet(){return this.#i}isCopied=e=>this.hasWebApi&&(this.allCopied||this.copiedKeySet.has(e));#o=!1;get allCopied(){return this.#o}getExtStorageApi=()=>globalThis.browser?.storage||globalThis.chrome?.storage;get hasExtensionApi(){try{return!!this.getExtStorageApi()}catch(e){return console.error(e),!1}}isWatchSupported=()=>this.hasExtensionApi;keyNamespace="";isValidKey=e=>e.startsWith(this.keyNamespace);getNamespacedKey=e=>`${this.keyNamespace}${e}`;getUnnamespacedKey=e=>e.slice(this.keyNamespace.length);serde={serializer:JSON.stringify,deserializer:JSON.parse};constructor({area:e="sync",allCopied:t=!1,copiedKeyList:r=[],serde:s={}}={}){this.setCopiedKeySet(r),this.#s=e,this.#o=t,this.serde={...this.serde,...s};try{this.hasWebApi&&(t||r.length>0)&&(this.#r=window.localStorage)}catch{}try{this.hasExtensionApi&&(this.#e=this.getExtStorageApi(),o()?this.#t=(0,i.default)(this.#e[this.area],{exclude:["getBytesInUse"],errorFirst:!1}):this.#t=this.#e[this.area])}catch{}}setCopiedKeySet(e){this.#i=new Set(e)}rawGetAll=()=>this.#t?.get();getAll=async()=>Object.entries(await this.rawGetAll()).filter(([e])=>this.isValidKey(e)).reduce((e,[t,r])=>(e[this.getUnnamespacedKey(t)]=r,e),{});copy=async e=>{let t=void 0===e;if(!t&&!this.copiedKeySet.has(e)||!this.allCopied||!this.hasExtensionApi)return!1;let r=this.allCopied?await this.rawGetAll():await this.#t.get((t?[...this.copiedKeySet]:[e]).map(this.getNamespacedKey));if(!r)return!1;let s=!1;for(let e in r){let t=r[e],n=this.#r?.getItem(e);this.#r?.setItem(e,t),s||=t!==n}return s};rawGet=async e=>(await this.rawGetMany([e]))[e];rawGetMany=async e=>this.hasExtensionApi?await this.#t.get(e):e.filter(this.isCopied).reduce((e,t)=>(e[t]=this.#r?.getItem(t),e),{});rawSet=async(e,t)=>await this.rawSetMany({[e]:t});rawSetMany=async e=>(this.#r&&Object.entries(e).filter(([e])=>this.isCopied(e)).forEach(([e,t])=>this.#r.setItem(e,t)),this.hasExtensionApi&&await this.#t.set(e),null);clear=async(e=!1)=>{e&&this.#r?.clear(),await this.#t.clear()};rawRemove=async e=>{await this.rawRemoveMany([e])};rawRemoveMany=async e=>{this.#r&&e.filter(this.isCopied).forEach(e=>this.#r.removeItem(e)),this.hasExtensionApi&&await this.#t.remove(e)};removeAll=async()=>{let e=Object.keys(await this.getAll());await this.removeMany(e)};watch=e=>{let t=this.isWatchSupported();return t&&this.#a(e),t};#a=e=>{for(let t in e){let r=this.getNamespacedKey(t),s=this.#n.get(r)?.callbackSet||new Set;if(s.add(e[t]),s.size>1)continue;let n=(e,t)=>{if(t!==this.area||!e[r])return;let s=this.#n.get(r);if(!s)throw Error(`Storage comms does not exist for nsKey: ${r}`);Promise.all([this.parseValue(e[r].newValue),this.parseValue(e[r].oldValue)]).then(([e,r])=>{for(let n of s.callbackSet)n({newValue:e,oldValue:r},t)})};this.#e.onChanged.addListener(n),this.#n.set(r,{callbackSet:s,listener:n})}};unwatch=e=>{let t=this.isWatchSupported();return t&&this.#l(e),t};#l(e){for(let t in e){let r=this.getNamespacedKey(t),s=e[t],n=this.#n.get(r);n&&(n.callbackSet.delete(s),0===n.callbackSet.size&&(this.#n.delete(r),this.#e.onChanged.removeListener(n.listener)))}}unwatchAll=()=>this.#u();#u(){this.#n.forEach(({listener:e})=>this.#e.onChanged.removeListener(e)),this.#n.clear()}async getItem(e){return this.get(e)}async getItems(e){return await this.getMany(e)}async setItem(e,t){await this.set(e,t)}async setItems(e){await await this.setMany(e)}async removeItem(e){return this.remove(e)}async removeItems(e){return await this.removeMany(e)}},l=class extends a{get=async e=>{let t=this.getNamespacedKey(e),r=await this.rawGet(t);return this.parseValue(r)};getMany=async e=>{let t=e.map(this.getNamespacedKey),r=await this.rawGetMany(t),s=await Promise.all(Object.values(r).map(this.parseValue));return Object.keys(r).reduce((e,t,r)=>(e[this.getUnnamespacedKey(t)]=s[r],e),{})};set=async(e,t)=>{let r=this.getNamespacedKey(e),s=this.serde.serializer(t);return this.rawSet(r,s)};setMany=async e=>{let t=Object.entries(e).reduce((e,[t,r])=>(e[this.getNamespacedKey(t)]=this.serde.serializer(r),e),{});return await this.rawSetMany(t)};remove=async e=>{let t=this.getNamespacedKey(e);return this.rawRemove(t)};removeMany=async e=>{let t=e.map(this.getNamespacedKey);return await this.rawRemoveMany(t)};setNamespace=e=>{this.keyNamespace=e};parseValue=async e=>{try{if(void 0!==e)return this.serde.deserializer(e)}catch(e){console.error(e)}}}},{pify:"2mL3q","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],"2mL3q":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);let n=(e,t,r,s)=>function(...n){let i=t.promiseModule;return new i((i,o)=>{t.multiArgs?n.push((...e)=>{t.errorFirst?e[0]?o(e):(e.shift(),i(e)):i(e)}):t.errorFirst?n.push((e,t)=>{e?o(e):i(t)}):n.push(i),Reflect.apply(e,this===r?s:this,n)})},i=new WeakMap;function o(e,t){t={exclude:[/.+(?:Sync|Stream)$/],errorFirst:!0,promiseModule:Promise,...t};let r=typeof e;if(!(null!==e&&("object"===r||"function"===r)))throw TypeError(`Expected \`input\` to be a \`Function\` or \`Object\`, got \`${null===e?"null":r}\``);let s=(e,r)=>{let s=i.get(e);if(s||(s={},i.set(e,s)),r in s)return s[r];let n=e=>"string"==typeof e||"symbol"==typeof r?r===e:e.test(r),o=Reflect.getOwnPropertyDescriptor(e,r),a=void 0===o||o.writable||o.configurable,l=t.include?t.include.some(e=>n(e)):!t.exclude.some(e=>n(e)),u=l&&a;return s[r]=u,u},o=new WeakMap,a=new Proxy(e,{apply(e,r,s){let i=o.get(e);if(i)return Reflect.apply(i,r,s);let l=t.excludeMain?e:n(e,t,a,e);return o.set(e,l),Reflect.apply(l,r,s)},get(e,r){let i=e[r];if(!s(e,r)||i===Function.prototype[r])return i;let l=o.get(i);if(l)return l;if("function"==typeof i){let r=n(i,t,a,e);return o.set(i,r),r}return i}});return a}},{"@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],f6DG4:[function(e,t,r){r.interopDefault=function(e){return e&&e.__esModule?e:{default:e}},r.defineInteropFlag=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.exportAll=function(e,t){return Object.keys(e).forEach(function(r){"default"===r||"__esModule"===r||t.hasOwnProperty(r)||Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[r]}})}),t},r.export=function(e,t,r){Object.defineProperty(e,t,{enumerable:!0,get:r})}},{}],bKOGH:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"BaseConvexClient",()=>n.BaseConvexClient),s.export(r,"ConvexClient",()=>i.ConvexClient),s.export(r,"ConvexHttpClient",()=>o.ConvexHttpClient);var n=e("./sync/client.js"),i=e("./simple_client.js"),o=e("./http_client.js")},{"./sync/client.js":"k0sdM","./simple_client.js":"3gW31","./http_client.js":"wlBrJ","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],k0sdM:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"BaseConvexClient",()=>j);var n=e("../../index.js"),i=e("../../values/index.js"),o=e("../logging.js"),a=e("./local_state.js"),l=e("./request_manager.js"),u=e("./optimistic_updates_impl.js"),c=e("./remote_query_set.js"),h=e("./udf_path_utils.js"),d=e("./web_socket_manager.js"),p=e("./session.js"),f=e("./authentication_manager.js"),g=e("./metrics.js"),m=e("../../common/index.js"),y=e("../../values/errors.js"),v=e("../../vendor/jwt-decode/index.js"),b=Object.defineProperty,w=(e,t,r)=>t in e?b(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,x=(e,t,r)=>w(e,"symbol"!=typeof t?t+"":t,r);class j{constructor(e,t,r){let s;if(x(this,"address"),x(this,"state"),x(this,"requestManager"),x(this,"webSocketManager"),x(this,"authenticationManager"),x(this,"remoteQuerySet"),x(this,"optimisticQueryResults"),x(this,"_transitionHandlerCounter",0),x(this,"_nextRequestId"),x(this,"_onTransitionFns",new Map),x(this,"_sessionId"),x(this,"firstMessageReceived",!1),x(this,"debug"),x(this,"logger"),x(this,"maxObservedTimestamp"),x(this,"connectionStateSubscribers",new Map),x(this,"nextConnectionStateSubscriberId",0),x(this,"_lastPublishedConnectionState"),x(this,"markConnectionStateDirty",()=>{Promise.resolve().then(()=>{let e=this.connectionState();if(JSON.stringify(e)!==JSON.stringify(this._lastPublishedConnectionState))for(let t of(this._lastPublishedConnectionState=e,this.connectionStateSubscribers.values()))t(e)})}),x(this,"mark",e=>{this.debug&&(0,g.mark)(e,this.sessionId)}),"object"==typeof e)throw Error("Passing a ClientConfig object is no longer supported. Pass the URL of the Convex deployment as a string directly.");r?.skipConvexDeploymentUrlCheck!==!0&&(0,m.validateDeploymentUrl)(e),r={...r};let i=r.authRefreshTokenLeewaySeconds??2,h=r.webSocketConstructor;if(!h&&"undefined"==typeof WebSocket)throw Error("No WebSocket global variable defined! To use Convex in an environment without WebSocket try the HTTP client: https://docs.convex.dev/api/classes/browser.ConvexHttpClient");h=h||WebSocket,this.debug=r.reportDebugInfoToConvex??!1,this.address=e,this.logger=!1===r.logger?(0,o.instantiateNoopLogger)({verbose:r.verbose??!1}):!0!==r.logger&&r.logger?r.logger:(0,o.instantiateDefaultLogger)({verbose:r.verbose??!1});let y=e.search("://");if(-1===y)throw Error("Provided address was not an absolute URL.");let v=e.substring(y+3),b=e.substring(0,y);if("http"===b)s="ws";else if("https"===b)s="wss";else throw Error(`Unknown parent protocol ${b}`);let w=`${s}://${v}/api/${n.version}/sync`;this.state=new a.LocalSyncState,this.remoteQuerySet=new c.RemoteQuerySet(e=>this.state.queryPath(e),this.logger),this.requestManager=new l.RequestManager(this.logger,this.markConnectionStateDirty);let j=()=>{this.webSocketManager.pause(),this.state.pause()};this.authenticationManager=new f.AuthenticationManager(this.state,{authenticate:e=>{let t=this.state.setAuth(e);return this.webSocketManager.sendMessage(t),t.baseVersion},stopSocket:()=>this.webSocketManager.stop(),tryRestartSocket:()=>this.webSocketManager.tryRestart(),pauseSocket:j,resumeSocket:()=>this.webSocketManager.resume(),clearAuth:()=>{this.clearAuth()}},{logger:this.logger,refreshTokenLeewaySeconds:i}),this.optimisticQueryResults=new u.OptimisticQueryResults,this.addOnTransitionHandler(e=>{t(e.queries.map(e=>e.token))}),this._nextRequestId=0,this._sessionId=(0,p.newSessionId)();let{unsavedChangesWarning:S}=r;if("undefined"==typeof window||void 0===window.addEventListener){if(!0===S)throw Error("unsavedChangesWarning requested, but window.addEventListener not found! Remove {unsavedChangesWarning: true} from Convex client options.")}else!1!==S&&window.addEventListener("beforeunload",e=>{if(this.requestManager.hasIncompleteRequests()){e.preventDefault();let t="Are you sure you want to leave? Your changes may not be saved.";return(e||window.event).returnValue=t,t}});this.webSocketManager=new d.WebSocketManager(w,{onOpen:e=>{this.mark("convexWebSocketOpen"),this.webSocketManager.sendMessage({...e,type:"Connect",sessionId:this._sessionId,maxObservedTimestamp:this.maxObservedTimestamp});let t=new Set(this.remoteQuerySet.remoteQueryResults().keys());this.remoteQuerySet=new c.RemoteQuerySet(e=>this.state.queryPath(e),this.logger);let[r,s]=this.state.restart(t);for(let e of(s&&this.webSocketManager.sendMessage(s),this.webSocketManager.sendMessage(r),this.requestManager.restart()))this.webSocketManager.sendMessage(e)},onResume:()=>{let[e,t]=this.state.resume();for(let r of(t&&this.webSocketManager.sendMessage(t),e&&this.webSocketManager.sendMessage(e),this.requestManager.resume()))this.webSocketManager.sendMessage(r)},onMessage:e=>{switch(this.firstMessageReceived||(this.firstMessageReceived=!0,this.mark("convexFirstMessageReceived"),this.reportMarks()),e.type){case"Transition":{this.observedTimestamp(e.endVersion.ts),this.authenticationManager.onTransition(e),this.remoteQuerySet.transition(e),this.state.transition(e);let t=this.requestManager.removeCompleted(this.remoteQuerySet.timestamp());this.notifyOnQueryResultChanges(t);break}case"MutationResponse":{e.success&&this.observedTimestamp(e.ts);let t=this.requestManager.onResponse(e);null!==t&&this.notifyOnQueryResultChanges(new Map([[t.requestId,t.result]]));break}case"ActionResponse":this.requestManager.onResponse(e);break;case"AuthError":this.authenticationManager.onAuthError(e);break;case"FatalError":{let t=(0,o.logFatalError)(this.logger,e.error);throw this.webSocketManager.terminate(),t}}return{hasSyncedPastLastReconnect:this.hasSyncedPastLastReconnect()}},onServerDisconnectError:r.onServerDisconnectError},h,this.logger,this.markConnectionStateDirty,this.debug),this.mark("convexClientConstructed"),r.expectAuth&&j()}hasSyncedPastLastReconnect(){let e=this.requestManager.hasSyncedPastLastReconnect()||this.state.hasSyncedPastLastReconnect();return e}observedTimestamp(e){(void 0===this.maxObservedTimestamp||this.maxObservedTimestamp.lessThanOrEqual(e))&&(this.maxObservedTimestamp=e)}getMaxObservedTimestamp(){return this.maxObservedTimestamp}notifyOnQueryResultChanges(e){let t=this.remoteQuerySet.remoteQueryResults(),r=new Map;for(let[e,s]of t){let t=this.state.queryToken(e);if(null!==t){let n={result:s,udfPath:this.state.queryPath(e),args:this.state.queryArgs(e)};r.set(t,n)}}let s=this.optimisticQueryResults.ingestQueryResultsFromServer(r,new Set(e.keys()));this.handleTransition({queries:s.map(e=>{let t=this.optimisticQueryResults.rawQueryResult(e);return{token:e,modification:{kind:"Updated",result:t}}}),reflectedMutations:Array.from(e).map(([e,t])=>({requestId:e,result:t})),timestamp:this.remoteQuerySet.timestamp()})}handleTransition(e){for(let t of this._onTransitionFns.values())t(e)}addOnTransitionHandler(e){let t=this._transitionHandlerCounter++;return this._onTransitionFns.set(t,e),()=>this._onTransitionFns.delete(t)}getCurrentAuthClaims(){let e=this.state.getAuth(),t={};if(e&&"User"===e.tokenType){try{t=e?(0,v.jwtDecode)(e.value):{}}catch{t={}}return{token:e.value,decoded:t}}}setAuth(e,t){this.authenticationManager.setConfig(e,t)}hasAuth(){return this.state.hasAuth()}setAdminAuth(e,t){let r=this.state.setAdminAuth(e,t);this.webSocketManager.sendMessage(r)}clearAuth(){let e=this.state.clearAuth();this.webSocketManager.sendMessage(e)}subscribe(e,t,r){let s=(0,m.parseArgs)(t),{modification:n,queryToken:i,unsubscribe:o}=this.state.subscribe(e,s,r?.journal,r?.componentPath);return null!==n&&this.webSocketManager.sendMessage(n),{queryToken:i,unsubscribe:()=>{let e=o();e&&this.webSocketManager.sendMessage(e)}}}localQueryResult(e,t){let r=(0,m.parseArgs)(t),s=(0,h.serializePathAndArgs)(e,r);return this.optimisticQueryResults.queryResult(s)}localQueryResultByToken(e){return this.optimisticQueryResults.queryResult(e)}hasLocalQueryResultByToken(e){return this.optimisticQueryResults.hasQueryResult(e)}localQueryLogs(e,t){let r=(0,m.parseArgs)(t),s=(0,h.serializePathAndArgs)(e,r);return this.optimisticQueryResults.queryLogs(s)}queryJournal(e,t){let r=(0,m.parseArgs)(t),s=(0,h.serializePathAndArgs)(e,r);return this.state.queryJournal(s)}connectionState(){let e=this.webSocketManager.connectionState();return{hasInflightRequests:this.requestManager.hasInflightRequests(),isWebSocketConnected:e.isConnected,hasEverConnected:e.hasEverConnected,connectionCount:e.connectionCount,connectionRetries:e.connectionRetries,timeOfOldestInflightRequest:this.requestManager.timeOfOldestInflightRequest(),inflightMutations:this.requestManager.inflightMutations(),inflightActions:this.requestManager.inflightActions()}}subscribeToConnectionState(e){let t=this.nextConnectionStateSubscriberId++;return this.connectionStateSubscribers.set(t,e),()=>{this.connectionStateSubscribers.delete(t)}}async mutation(e,t,r){let s=await this.mutationInternal(e,t,r);if(!s.success){if(void 0!==s.errorData)throw(0,o.forwardData)(s,new y.ConvexError((0,o.createHybridErrorStacktrace)("mutation",e,s)));throw Error((0,o.createHybridErrorStacktrace)("mutation",e,s))}return s.value}async mutationInternal(e,t,r,s){let{mutationPromise:n}=this.enqueueMutation(e,t,r,s);return n}enqueueMutation(e,t,r,s){let n=(0,m.parseArgs)(t);this.tryReportLongDisconnect();let o=this.nextRequestId;if(this._nextRequestId++,void 0!==r){let e=r.optimisticUpdate;if(void 0!==e){let t=this.optimisticQueryResults.applyOptimisticUpdate(t=>{let r=e(t,n);r instanceof Promise&&this.logger.warn("Optimistic update handler returned a Promise. Optimistic updates should be synchronous.")},o),r=t.map(e=>{let t=this.localQueryResultByToken(e);return{token:e,modification:{kind:"Updated",result:void 0===t?void 0:{success:!0,value:t,logLines:[]}}}});this.handleTransition({queries:r,reflectedMutations:[],timestamp:this.remoteQuerySet.timestamp()})}}let a={type:"Mutation",requestId:o,udfPath:e,componentPath:s,args:[(0,i.convexToJson)(n)]},l=this.webSocketManager.sendMessage(a),u=this.requestManager.request(a,l);return{requestId:o,mutationPromise:u}}async action(e,t){let r=await this.actionInternal(e,t);if(!r.success){if(void 0!==r.errorData)throw(0,o.forwardData)(r,new y.ConvexError((0,o.createHybridErrorStacktrace)("action",e,r)));throw Error((0,o.createHybridErrorStacktrace)("action",e,r))}return r.value}async actionInternal(e,t,r){let s=(0,m.parseArgs)(t),n=this.nextRequestId;this._nextRequestId++,this.tryReportLongDisconnect();let o={type:"Action",requestId:n,udfPath:e,componentPath:r,args:[(0,i.convexToJson)(s)]},a=this.webSocketManager.sendMessage(o);return this.requestManager.request(o,a)}async close(){return this.authenticationManager.stop(),this.webSocketManager.terminate()}get url(){return this.address}get nextRequestId(){return this._nextRequestId}get sessionId(){return this._sessionId}reportMarks(){if(this.debug){let e=(0,g.getMarksReport)(this.sessionId);this.webSocketManager.sendMessage({type:"Event",eventType:"ClientConnect",event:e})}}tryReportLongDisconnect(){if(!this.debug)return;let e=this.connectionState().timeOfOldestInflightRequest;if(null===e||Date.now()-e.getTime()<=6e4)return;let t=`${this.address}/api/debug_event`;fetch(t,{method:"POST",headers:{"Content-Type":"application/json","Convex-Client":`npm-${n.version}`},body:JSON.stringify({event:"LongWebsocketDisconnect"})}).then(e=>{e.ok||this.logger.warn("Analytics request failed with response:",e.body)}).catch(e=>{this.logger.warn("Analytics response failed with error:",e)})}}},{"../../index.js":"dF102","../../values/index.js":"dViyc","../logging.js":"5I2B4","./local_state.js":"jOxn7","./request_manager.js":"1q7Q4","./optimistic_updates_impl.js":"ulkb2","./remote_query_set.js":"i42ba","./udf_path_utils.js":"bhVyA","./web_socket_manager.js":"laM6w","./session.js":"aQJw1","./authentication_manager.js":"gNSME","./metrics.js":"iY5md","../../common/index.js":"l8P8A","../../values/errors.js":"dS3IT","../../vendor/jwt-decode/index.js":"j0Zfh","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],dF102:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"version",()=>n);let n="1.31.2"},{"@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],dViyc:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"convexToJson",()=>n.convexToJson),s.export(r,"jsonToConvex",()=>n.jsonToConvex),s.export(r,"v",()=>i.v),s.export(r,"asObjectValidator",()=>i.asObjectValidator),s.export(r,"compareValues",()=>l.compareValues),s.export(r,"Base64",()=>o);var n=e("./value.js"),i=e("./validator.js"),o=e("./base64.js"),a=e("./errors.js");s.exportAll(a,r);var l=e("./compare.js")},{"./value.js":"3mC5W","./validator.js":"b5eX5","./base64.js":"9KQDI","./errors.js":"dS3IT","./compare.js":"lBXLj","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],"3mC5W":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"slowBigIntToBase64",()=>d),s.export(r,"slowBase64ToBigInt",()=>p),s.export(r,"modernBigIntToBase64",()=>f),s.export(r,"modernBase64ToBigInt",()=>g),s.export(r,"bigIntToBase64",()=>m),s.export(r,"base64ToBigInt",()=>y),s.export(r,"jsonToConvex",()=>function e(t){if(null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t)return t;if(Array.isArray(t))return t.map(t=>e(t));if("object"!=typeof t)throw Error(`Unexpected type of ${t}`);let r=Object.entries(t);if(1===r.length){let e=r[0][0];if("$bytes"===e){if("string"!=typeof t.$bytes)throw Error(`Malformed $bytes field on ${t}`);return n.toByteArray(t.$bytes).buffer}if("$integer"===e){if("string"!=typeof t.$integer)throw Error(`Malformed $integer field on ${t}`);return y(t.$integer)}if("$float"===e){if("string"!=typeof t.$float)throw Error(`Malformed $float field on ${t}`);let e=n.toByteArray(t.$float);if(8!==e.byteLength)throw Error(`Received ${e.byteLength} bytes, expected 8 for $float`);let r=new DataView(e.buffer),s=r.getFloat64(0,!0);if(!h(s))throw Error(`Float ${s} should be encoded as a number`);return s}if("$set"===e)throw Error("Received a Set which is no longer supported as a Convex type.");if("$map"===e)throw Error("Received a Map which is no longer supported as a Convex type.")}let s={};for(let[r,n]of Object.entries(t))v(r),s[r]=e(n);return s}),s.export(r,"stringifyValueForError",()=>b),s.export(r,"convexToJson",()=>S),s.export(r,"convexOrUndefinedToJson",()=>k),s.export(r,"patchValueToJson",()=>A);var n=e("./base64.js"),i=e("../common/index.js");let o=BigInt("-9223372036854775808"),a=BigInt("9223372036854775807"),l=BigInt("0"),u=BigInt("8"),c=BigInt("256");function h(e){return Number.isNaN(e)||!Number.isFinite(e)||Object.is(e,-0)}function d(e){e<l&&(e-=o+o);let t=e.toString(16);t.length%2==1&&(t="0"+t);let r=new Uint8Array(new ArrayBuffer(8)),s=0;for(let n of t.match(/.{2}/g).reverse())r.set([parseInt(n,16)],s++),e>>=u;return n.fromByteArray(r)}function p(e){let t=n.toByteArray(e);if(8!==t.byteLength)throw Error(`Received ${t.byteLength} bytes, expected 8 for $integer`);let r=l,s=l;for(let e of t)r+=BigInt(e)*c**s,s++;return r>a&&(r+=o+o),r}function f(e){if(e<o||a<e)throw Error(`BigInt ${e} does not fit into a 64-bit signed integer.`);let t=new ArrayBuffer(8);return new DataView(t).setBigInt64(0,e,!0),n.fromByteArray(new Uint8Array(t))}function g(e){let t=n.toByteArray(e);if(8!==t.byteLength)throw Error(`Received ${t.byteLength} bytes, expected 8 for $integer`);let r=new DataView(t.buffer);return r.getBigInt64(0,!0)}let m=DataView.prototype.setBigInt64?f:d,y=DataView.prototype.getBigInt64?g:p;function v(e){if(e.length>1024)throw Error(`Field name ${e} exceeds maximum field name length 1024.`);if(e.startsWith("$"))throw Error(`Field name ${e} starts with a '$', which is reserved.`);for(let t=0;t<e.length;t+=1){let r=e.charCodeAt(t);if(r<32||r>=127)throw Error(`Field name ${e} has invalid character '${e[t]}': Field names can only contain non-control ASCII characters`)}}function b(e){let t=JSON.stringify(e,(e,t)=>void 0===t?"undefined":"bigint"==typeof t?`${t.toString()}n`:t);if(t.length>16384){let e="[...truncated]",r=16384-e.length,s=t.codePointAt(r-1);return void 0!==s&&s>65535&&(r-=1),t.substring(0,r)+e}return t}function w(e,t,r,s){if(void 0===e){let e=r&&` (present at path ${r} in original object ${b(t)})`;throw Error(`undefined is not a valid Convex value${e}. To learn about Convex's supported types, see https://docs.convex.dev/using/types.`)}if(null===e)return e;if("bigint"==typeof e){if(e<o||a<e)throw Error(`BigInt ${e} does not fit into a 64-bit signed integer.`);return{$integer:m(e)}}if("number"==typeof e){if(!h(e))return e;{let t=new ArrayBuffer(8);return new DataView(t).setFloat64(0,e,!0),{$float:n.fromByteArray(new Uint8Array(t))}}}if("boolean"==typeof e||"string"==typeof e)return e;if(e instanceof ArrayBuffer)return{$bytes:n.fromByteArray(new Uint8Array(e))};if(Array.isArray(e))return e.map((e,s)=>w(e,t,r+`[${s}]`,!1));if(e instanceof Set)throw Error(x(r,"Set",[...e],t));if(e instanceof Map)throw Error(x(r,"Map",[...e],t));if(!(0,i.isSimpleObject)(e)){let s=e?.constructor?.name,n=s?`${s} `:"";throw Error(x(r,n,e,t))}let l={},u=Object.entries(e);for(let[e,n]of(u.sort(([e,t],[r,s])=>e===r?0:e<r?-1:1),u))void 0!==n?(v(e),l[e]=w(n,t,r+`.${e}`,!1)):s&&(v(e),l[e]=j(n,t,r+`.${e}`));return l}function x(e,t,r,s){return e?`${t}${b(r)} is not a supported Convex type (present at path ${e} in original object ${b(s)}). To learn about Convex's supported types, see https://docs.convex.dev/using/types.`:`${t}${b(r)} is not a supported Convex type.`}function j(e,t,r){if(void 0===e)return{$undefined:null};if(void 0===t)throw Error(`Programming error. Current value is ${b(e)} but original value is undefined`);return w(e,t,r,!1)}function S(e){return w(e,e,"",!1)}function k(e){return j(e,e,"")}function A(e){return w(e,e,"",!0)}},{"./base64.js":"9KQDI","../common/index.js":"l8P8A","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],"9KQDI":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"byteLength",()=>h),s.export(r,"toByteArray",()=>d),s.export(r,"fromByteArray",()=>p),s.export(r,"fromByteArrayUrlSafeNoPadding",()=>f);for(var n=[],i=[],o=Uint8Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=0,u=a.length;l<u;++l)n[l]=a[l],i[a.charCodeAt(l)]=l;function c(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var s=r===t?0:4-r%4;return[r,s]}function h(e){var t=c(e),r=t[0],s=t[1];return(r+s)*3/4-s}function d(e){var t,r,s=c(e),n=s[0],a=s[1],l=new o((n+a)*3/4-a),u=0,h=a>0?n-4:n;for(r=0;r<h;r+=4)t=i[e.charCodeAt(r)]<<18|i[e.charCodeAt(r+1)]<<12|i[e.charCodeAt(r+2)]<<6|i[e.charCodeAt(r+3)],l[u++]=t>>16&255,l[u++]=t>>8&255,l[u++]=255&t;return 2===a&&(t=i[e.charCodeAt(r)]<<2|i[e.charCodeAt(r+1)]>>4,l[u++]=255&t),1===a&&(t=i[e.charCodeAt(r)]<<10|i[e.charCodeAt(r+1)]<<4|i[e.charCodeAt(r+2)]>>2,l[u++]=t>>8&255,l[u++]=255&t),l}function p(e){for(var t,r=e.length,s=r%3,i=[],o=0,a=r-s;o<a;o+=16383)i.push(function(e,t,r){for(var s,i=[],o=t;o<r;o+=3)i.push(n[(s=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]))>>18&63]+n[s>>12&63]+n[s>>6&63]+n[63&s]);return i.join("")}(e,o,o+16383>a?a:o+16383));return 1===s?i.push(n[(t=e[r-1])>>2]+n[t<<4&63]+"=="):2===s&&i.push(n[(t=(e[r-2]<<8)+e[r-1])>>10]+n[t>>4&63]+n[t<<2&63]+"="),i.join("")}function f(e){return p(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},{"@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],l8P8A:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");function n(e){if(void 0===e)return{};if(!o(e))throw Error(`The arguments to a Convex function must be an object. Received: ${e}`);return e}function i(e){if(void 0===e)throw Error("Client created with undefined deployment address. If you used an environment variable, check that it's set.");if("string"!=typeof e)throw Error(`Invalid deployment address: found ${e}".`);if(!(e.startsWith("http:")||e.startsWith("https:")))throw Error(`Invalid deployment address: Must start with "https://" or "http://". Found "${e}".`);try{new URL(e)}catch{throw Error(`Invalid deployment address: "${e}" is not a valid URL. If you believe this URL is correct, use the \`skipConvexDeploymentUrlCheck\` option to bypass this.`)}if(e.endsWith(".convex.site"))throw Error(`Invalid deployment address: "${e}" ends with .convex.site, which is used for HTTP Actions. Convex deployment URLs typically end with .convex.cloud? If you believe this URL is correct, use the \`skipConvexDeploymentUrlCheck\` option to bypass this.`)}function o(e){let t="object"==typeof e,r=Object.getPrototypeOf(e),s=null===r||r===Object.prototype||r?.constructor?.name==="Object";return t&&s}s.defineInteropFlag(r),s.export(r,"parseArgs",()=>n),s.export(r,"validateDeploymentUrl",()=>i),s.export(r,"isSimpleObject",()=>o)},{"@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],b5eX5:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"isValidator",()=>i),s.export(r,"asObjectValidator",()=>o),s.export(r,"v",()=>a);var n=e("./validators.js");function i(e){return!!e.isConvexValidator}function o(e){return i(e)?e:a.object(e)}let a={id:e=>new n.VId({isOptional:"required",tableName:e}),null:()=>new n.VNull({isOptional:"required"}),number:()=>new n.VFloat64({isOptional:"required"}),float64:()=>new n.VFloat64({isOptional:"required"}),bigint:()=>new n.VInt64({isOptional:"required"}),int64:()=>new n.VInt64({isOptional:"required"}),boolean:()=>new n.VBoolean({isOptional:"required"}),string:()=>new n.VString({isOptional:"required"}),bytes:()=>new n.VBytes({isOptional:"required"}),literal:e=>new n.VLiteral({isOptional:"required",value:e}),array:e=>new n.VArray({isOptional:"required",element:e}),object:e=>new n.VObject({isOptional:"required",fields:e}),record:(e,t)=>new n.VRecord({isOptional:"required",key:e,value:t}),union:(...e)=>new n.VUnion({isOptional:"required",members:e}),any:()=>new n.VAny({isOptional:"required"}),optional:e=>e.asOptional(),nullable:e=>a.union(e,a.null())}},{"./validators.js":"5l3KY","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],"5l3KY":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"VId",()=>c),s.export(r,"VFloat64",()=>h),s.export(r,"VInt64",()=>d),s.export(r,"VBoolean",()=>p),s.export(r,"VBytes",()=>f),s.export(r,"VString",()=>g),s.export(r,"VNull",()=>m),s.export(r,"VAny",()=>y),s.export(r,"VObject",()=>v),s.export(r,"VLiteral",()=>b),s.export(r,"VArray",()=>w),s.export(r,"VRecord",()=>x),s.export(r,"VUnion",()=>j);var n=e("./value.js"),i=Object.defineProperty,o=(e,t,r)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,a=(e,t,r)=>o(e,"symbol"!=typeof t?t+"":t,r);function l(e,t){let r=void 0!==t?` for field "${t}"`:"";throw Error(`A validator is undefined${r} in ${e}. This is often caused by circular imports. See https://docs.convex.dev/error#undefined-validator for details.`)}class u{constructor({isOptional:e}){a(this,"type"),a(this,"fieldPaths"),a(this,"isOptional"),a(this,"isConvexValidator"),this.isOptional=e,this.isConvexValidator=!0}}class c extends u{constructor({isOptional:e,tableName:t}){if(super({isOptional:e}),a(this,"tableName"),a(this,"kind","id"),"string"!=typeof t)throw Error("v.id(tableName) requires a string");this.tableName=t}get json(){return{type:"id",tableName:this.tableName}}asOptional(){return new c({isOptional:"optional",tableName:this.tableName})}}class h extends u{constructor(){super(...arguments),a(this,"kind","float64")}get json(){return{type:"number"}}asOptional(){return new h({isOptional:"optional"})}}class d extends u{constructor(){super(...arguments),a(this,"kind","int64")}get json(){return{type:"bigint"}}asOptional(){return new d({isOptional:"optional"})}}class p extends u{constructor(){super(...arguments),a(this,"kind","boolean")}get json(){return{type:this.kind}}asOptional(){return new p({isOptional:"optional"})}}class f extends u{constructor(){super(...arguments),a(this,"kind","bytes")}get json(){return{type:this.kind}}asOptional(){return new f({isOptional:"optional"})}}class g extends u{constructor(){super(...arguments),a(this,"kind","string")}get json(){return{type:this.kind}}asOptional(){return new g({isOptional:"optional"})}}class m extends u{constructor(){super(...arguments),a(this,"kind","null")}get json(){return{type:this.kind}}asOptional(){return new m({isOptional:"optional"})}}class y extends u{constructor(){super(...arguments),a(this,"kind","any")}get json(){return{type:this.kind}}asOptional(){return new y({isOptional:"optional"})}}class v extends u{constructor({isOptional:e,fields:t}){super({isOptional:e}),a(this,"fields"),a(this,"kind","object"),globalThis.Object.entries(t).forEach(([e,t])=>{if(void 0===t&&l("v.object()",e),!t.isConvexValidator)throw Error("v.object() entries must be validators")}),this.fields=t}get json(){return{type:this.kind,value:globalThis.Object.fromEntries(globalThis.Object.entries(this.fields).map(([e,t])=>[e,{fieldType:t.json,optional:"optional"===t.isOptional}]))}}asOptional(){return new v({isOptional:"optional",fields:this.fields})}omit(...e){let t={...this.fields};for(let r of e)delete t[r];return new v({isOptional:this.isOptional,fields:t})}pick(...e){let t={};for(let r of e)t[r]=this.fields[r];return new v({isOptional:this.isOptional,fields:t})}partial(){let e={};for(let[t,r]of globalThis.Object.entries(this.fields))e[t]=r.asOptional();return new v({isOptional:this.isOptional,fields:e})}extend(e){return new v({isOptional:this.isOptional,fields:{...this.fields,...e}})}}class b extends u{constructor({isOptional:e,value:t}){if(super({isOptional:e}),a(this,"value"),a(this,"kind","literal"),"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t&&"bigint"!=typeof t)throw Error("v.literal(value) must be a string, number, or boolean");this.value=t}get json(){return{type:this.kind,value:(0,n.convexToJson)(this.value)}}asOptional(){return new b({isOptional:"optional",value:this.value})}}class w extends u{constructor({isOptional:e,element:t}){super({isOptional:e}),a(this,"element"),a(this,"kind","array"),void 0===t&&l("v.array()"),this.element=t}get json(){return{type:this.kind,value:this.element.json}}asOptional(){return new w({isOptional:"optional",element:this.element})}}class x extends u{constructor({isOptional:e,key:t,value:r}){if(super({isOptional:e}),a(this,"key"),a(this,"value"),a(this,"kind","record"),void 0===t&&l("v.record()","key"),void 0===r&&l("v.record()","value"),"optional"===t.isOptional)throw Error("Record validator cannot have optional keys");if("optional"===r.isOptional)throw Error("Record validator cannot have optional values");if(!t.isConvexValidator||!r.isConvexValidator)throw Error("Key and value of v.record() but be validators");this.key=t,this.value=r}get json(){return{type:this.kind,keys:this.key.json,values:{fieldType:this.value.json,optional:!1}}}asOptional(){return new x({isOptional:"optional",key:this.key,value:this.value})}}class j extends u{constructor({isOptional:e,members:t}){super({isOptional:e}),a(this,"members"),a(this,"kind","union"),t.forEach((e,t)=>{if(void 0===e&&l("v.union()",`member at index ${t}`),!e.isConvexValidator)throw Error("All members of v.union() must be validators")}),this.members=t}get json(){return{type:this.kind,value:this.members.map(e=>e.json)}}asOptional(){return new j({isOptional:"optional",members:this.members})}}},{"./value.js":"3mC5W","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],dS3IT:[function(e,t,r){var s,n,i=e("@parcel/transformer-js/src/esmodule-helpers.js");i.defineInteropFlag(r),i.export(r,"ConvexError",()=>h);var o=e("./value.js"),a=Object.defineProperty,l=(e,t,r)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,u=(e,t,r)=>l(e,"symbol"!=typeof t?t+"":t,r);let c=Symbol.for("ConvexError");class h extends(n=Error,s=c,n){constructor(e){super("string"==typeof e?e:(0,o.stringifyValueForError)(e)),u(this,"name","ConvexError"),u(this,"data"),u(this,s,!0),this.data=e}}},{"./value.js":"3mC5W","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],lBXLj:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"compareValues",()=>i);var n=e("./compare_utf8.js");function i(e,t){return function e(t,r){return t[0]===r[0]?function(t,r){if(null==t)return 0;if("number"==typeof t){if("number"!=typeof r)throw Error(`Unexpected type ${r}`);return function(e,t){if(isNaN(e)||isNaN(t)){let r=new ArrayBuffer(8),s=new ArrayBuffer(8);new DataView(r).setFloat64(0,e,!0),new DataView(s).setFloat64(0,t,!0);let n=BigInt(new DataView(r).getBigInt64(0,!0)),i=BigInt(new DataView(s).getBigInt64(0,!0)),o=(0x8000000000000000n&n)!==0n,a=(0x8000000000000000n&i)!==0n;return isNaN(e)!==isNaN(t)?isNaN(e)?o?-1:1:a?1:-1:o!==a?o?-1:1:n<i?-1:n===i?0:1}return Object.is(e,t)?0:Object.is(e,-0)?Object.is(t,0)?-1:-Math.sign(t):Object.is(t,-0)?Object.is(e,0)?1:Math.sign(e):e<t?-1:1}(t,r)}if("string"==typeof t){if("string"!=typeof r)throw Error(`Unexpected type ${r}`);return(0,n.compareUTF8)(t,r)}if("bigint"==typeof t||"boolean"==typeof t||"string"==typeof t)return t<r?-1:t===r?0:1;if(!Array.isArray(t)||!Array.isArray(r))throw Error(`Unexpected type ${t}`);for(let s=0;s<t.length&&s<r.length;s++){let n=e(t[s],r[s]);if(0!==n)return n}return t.length<r.length?-1:t.length>r.length?1:0}(t[1],r[1]):t[0]<r[0]?-1:1}(o(e),o(t))}function o(e){if(void 0===e)return[0,void 0];if(null===e)return[1,null];if("bigint"==typeof e)return[2,e];if("number"==typeof e)return[3,e];if("boolean"==typeof e)return[4,e];if("string"==typeof e)return[5,e];if(e instanceof ArrayBuffer)return[6,Array.from(new Uint8Array(e)).map(o)];if(Array.isArray(e))return[7,e.map(o)];let t=Object.keys(e).sort(),r=t.map(t=>[t,e[t]]);return[8,r.map(o)]}},{"./compare_utf8.js":"aR6RI","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],aR6RI:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");function n(e,t){let r=e.length,s=t.length,n=Math.min(r,s);for(let r=0;r<n;){let s=e.codePointAt(r),n=t.codePointAt(r);if(s!==n){if(s<128&&n<128)return s-n;let e=u(s,a),t=u(n,l);return function(e,t,r,s){let n=Math.min(t,s);for(let t=0;t<n;t++){let s=e[t],n=r[t];if(s!==n)return s-n}return t-s}(a,e,l,t)}r+=i(s)}return r-s}function i(e){return e>65535?2:1}s.defineInteropFlag(r),s.export(r,"compareUTF8",()=>n),s.export(r,"utf16LengthForCodePoint",()=>i),s.export(r,"greaterThan",()=>c),s.export(r,"greaterThanEq",()=>h),s.export(r,"lessThan",()=>d),s.export(r,"lessThanEq",()=>p);let o=()=>Array.from({length:4},()=>0),a=o(),l=o();function u(e,t){let r,s;if(e<128)return t[0]=e,1;if(e<=2047)r=1,s=192;else if(e<=65535)r=2,s=224;else if(e<=1114111)r=3,s=240;else throw Error("Invalid code point");t[0]=(e>>6*r)+s;let n=1;for(;r>0;r--){let s=e>>6*(r-1);t[n++]=128|63&s}return n}function c(e,t){return n(e,t)>0}function h(e,t){return n(e,t)>=0}function d(e,t){return 0>n(e,t)}function p(e,t){return 0>=n(e,t)}},{"@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],"5I2B4":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"DefaultLogger",()=>l),s.export(r,"instantiateDefaultLogger",()=>u),s.export(r,"instantiateNoopLogger",()=>c),s.export(r,"logForFunction",()=>h),s.export(r,"logFatalError",()=>d),s.export(r,"createHybridErrorStacktrace",()=>p),s.export(r,"forwardData",()=>f);var n=Object.defineProperty,i=(e,t,r)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,o=(e,t,r)=>i(e,"symbol"!=typeof t?t+"":t,r);function a(e){switch(e){case"query":return"Q";case"mutation":return"M";case"action":return"A";case"any":return"?"}}class l{constructor(e){o(this,"_onLogLineFuncs"),o(this,"_verbose"),this._onLogLineFuncs={},this._verbose=e.verbose}addLogLineListener(e){let t=Math.random().toString(36).substring(2,15);for(let e=0;e<10&&void 0!==this._onLogLineFuncs[t];e++)t=Math.random().toString(36).substring(2,15);return this._onLogLineFuncs[t]=e,()=>{delete this._onLogLineFuncs[t]}}logVerbose(...e){if(this._verbose)for(let t of Object.values(this._onLogLineFuncs))t("debug",`${new Date().toISOString()}`,...e)}log(...e){for(let t of Object.values(this._onLogLineFuncs))t("info",...e)}warn(...e){for(let t of Object.values(this._onLogLineFuncs))t("warn",...e)}error(...e){for(let t of Object.values(this._onLogLineFuncs))t("error",...e)}}function u(e){let t=new l(e);return t.addLogLineListener((e,...t)=>{switch(e){case"debug":console.debug(...t);break;case"info":default:console.log(...t);break;case"warn":console.warn(...t);break;case"error":console.error(...t)}}),t}function c(e){return new l(e)}function h(e,t,r,s,n){let i=a(r);if("object"==typeof n&&(n=`ConvexError ${JSON.stringify(n.errorData,null,2)}`),"info"===t){let t=n.match(/^\[.*?\] /);if(null===t){e.error(`[CONVEX ${i}(${s})] Could not parse console.log`);return}let r=n.slice(1,t[0].length-2),o=n.slice(t[0].length);e.log(`%c[CONVEX ${i}(${s})] [${r}]`,"color:rgb(0, 145, 255)",o)}else e.error(`[CONVEX ${i}(${s})] ${n}`)}function d(e,t){let r=`[CONVEX FATAL ERROR] ${t}`;return e.error(r),Error(r)}function p(e,t,r){let s=a(e);return`[CONVEX ${s}(${t})] ${r.errorMessage}
  Called by client`}function f(e,t){return t.data=e.errorData,t}},{"@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],jOxn7:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"LocalSyncState",()=>u);var n=e("../../values/index.js"),i=e("./udf_path_utils.js"),o=Object.defineProperty,a=(e,t,r)=>t in e?o(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,l=(e,t,r)=>a(e,"symbol"!=typeof t?t+"":t,r);class u{constructor(){l(this,"nextQueryId"),l(this,"querySetVersion"),l(this,"querySet"),l(this,"queryIdToToken"),l(this,"identityVersion"),l(this,"auth"),l(this,"outstandingQueriesOlderThanRestart"),l(this,"outstandingAuthOlderThanRestart"),l(this,"paused"),l(this,"pendingQuerySetModifications"),this.nextQueryId=0,this.querySetVersion=0,this.identityVersion=0,this.querySet=new Map,this.queryIdToToken=new Map,this.outstandingQueriesOlderThanRestart=new Set,this.outstandingAuthOlderThanRestart=!1,this.paused=!1,this.pendingQuerySetModifications=new Map}hasSyncedPastLastReconnect(){return 0===this.outstandingQueriesOlderThanRestart.size&&!this.outstandingAuthOlderThanRestart}markAuthCompletion(){this.outstandingAuthOlderThanRestart=!1}subscribe(e,t,r,s){let o=(0,i.canonicalizeUdfPath)(e),a=(0,i.serializePathAndArgs)(o,t),l=this.querySet.get(a);if(void 0!==l)return l.numSubscribers+=1,{queryToken:a,modification:null,unsubscribe:()=>this.removeSubscriber(a)};{let e=this.nextQueryId++;this.querySet.set(a,{id:e,canonicalizedUdfPath:o,args:t,numSubscribers:1,journal:r,componentPath:s}),this.queryIdToToken.set(e,a);let i=this.querySetVersion,l=this.querySetVersion+1,u={type:"Add",queryId:e,udfPath:o,args:[(0,n.convexToJson)(t)],journal:r,componentPath:s};return this.paused?this.pendingQuerySetModifications.set(e,u):this.querySetVersion=l,{queryToken:a,modification:{type:"ModifyQuerySet",baseVersion:i,newVersion:l,modifications:[u]},unsubscribe:()=>this.removeSubscriber(a)}}}transition(e){for(let t of e.modifications)switch(t.type){case"QueryUpdated":case"QueryFailed":{this.outstandingQueriesOlderThanRestart.delete(t.queryId);let e=t.journal;if(void 0!==e){let r=this.queryIdToToken.get(t.queryId);void 0!==r&&(this.querySet.get(r).journal=e)}break}case"QueryRemoved":this.outstandingQueriesOlderThanRestart.delete(t.queryId);break;default:throw Error(`Invalid modification ${t.type}`)}}queryId(e,t){let r=(0,i.canonicalizeUdfPath)(e),s=(0,i.serializePathAndArgs)(r,t),n=this.querySet.get(s);return void 0!==n?n.id:null}isCurrentOrNewerAuthVersion(e){return e>=this.identityVersion}getAuth(){return this.auth}setAuth(e){this.auth={tokenType:"User",value:e};let t=this.identityVersion;return this.paused||(this.identityVersion=t+1),{type:"Authenticate",baseVersion:t,...this.auth}}setAdminAuth(e,t){let r={tokenType:"Admin",value:e,impersonating:t};this.auth=r;let s=this.identityVersion;return this.paused||(this.identityVersion=s+1),{type:"Authenticate",baseVersion:s,...r}}clearAuth(){this.auth=void 0,this.markAuthCompletion();let e=this.identityVersion;return this.paused||(this.identityVersion=e+1),{type:"Authenticate",tokenType:"None",baseVersion:e}}hasAuth(){return!!this.auth}isNewAuth(e){return this.auth?.value!==e}queryPath(e){let t=this.queryIdToToken.get(e);return t?this.querySet.get(t).canonicalizedUdfPath:null}queryArgs(e){let t=this.queryIdToToken.get(e);return t?this.querySet.get(t).args:null}queryToken(e){return this.queryIdToToken.get(e)??null}queryJournal(e){return this.querySet.get(e)?.journal}restart(e){this.unpause(),this.outstandingQueriesOlderThanRestart.clear();let t=[];for(let r of this.querySet.values()){let s={type:"Add",queryId:r.id,udfPath:r.canonicalizedUdfPath,args:[(0,n.convexToJson)(r.args)],journal:r.journal,componentPath:r.componentPath};t.push(s),e.has(r.id)||this.outstandingQueriesOlderThanRestart.add(r.id)}this.querySetVersion=1;let r={type:"ModifyQuerySet",baseVersion:0,newVersion:1,modifications:t};if(!this.auth)return this.identityVersion=0,[r,void 0];this.outstandingAuthOlderThanRestart=!0;let s={type:"Authenticate",baseVersion:0,...this.auth};return this.identityVersion=1,[r,s]}pause(){this.paused=!0}resume(){let e=this.pendingQuerySetModifications.size>0?{type:"ModifyQuerySet",baseVersion:this.querySetVersion,newVersion:++this.querySetVersion,modifications:Array.from(this.pendingQuerySetModifications.values())}:void 0,t=void 0!==this.auth?{type:"Authenticate",baseVersion:this.identityVersion++,...this.auth}:void 0;return this.unpause(),[e,t]}unpause(){this.paused=!1,this.pendingQuerySetModifications.clear()}removeSubscriber(e){let t=this.querySet.get(e);if(t.numSubscribers>1)return t.numSubscribers-=1,null;{this.querySet.delete(e),this.queryIdToToken.delete(t.id),this.outstandingQueriesOlderThanRestart.delete(t.id);let r=this.querySetVersion,s=this.querySetVersion+1,n={type:"Remove",queryId:t.id};return this.paused?this.pendingQuerySetModifications.has(t.id)?this.pendingQuerySetModifications.delete(t.id):this.pendingQuerySetModifications.set(t.id,n):this.querySetVersion=s,{type:"ModifyQuerySet",baseVersion:r,newVersion:s,modifications:[n]}}}}},{"../../values/index.js":"dViyc","./udf_path_utils.js":"bhVyA","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],bhVyA:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"canonicalizeUdfPath",()=>i),s.export(r,"serializePathAndArgs",()=>o),s.export(r,"serializePaginatedPathAndArgs",()=>a),s.export(r,"serializedQueryTokenIsPaginated",()=>l);var n=e("../../values/index.js");function i(e){let t,r;let s=e.split(":");return 1===s.length?(t=s[0],r="default"):(t=s.slice(0,s.length-1).join(":"),r=s[s.length-1]),t.endsWith(".js")&&(t=t.slice(0,-3)),`${t}:${r}`}function o(e,t){return JSON.stringify({udfPath:i(e),args:(0,n.convexToJson)(t)})}function a(e,t,r){let{initialNumItems:s,id:o}=r,a=JSON.stringify({type:"paginated",udfPath:i(e),args:(0,n.convexToJson)(t),options:(0,n.convexToJson)({initialNumItems:s,id:o})});return a}function l(e){return"paginated"===JSON.parse(e).type}},{"../../values/index.js":"dViyc","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],"1q7Q4":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"RequestManager",()=>u);var n=e("../../values/index.js"),i=e("../logging.js"),o=Object.defineProperty,a=(e,t,r)=>t in e?o(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,l=(e,t,r)=>a(e,"symbol"!=typeof t?t+"":t,r);class u{constructor(e,t){this.logger=e,this.markConnectionStateDirty=t,l(this,"inflightRequests"),l(this,"requestsOlderThanRestart"),l(this,"inflightMutationsCount",0),l(this,"inflightActionsCount",0),this.inflightRequests=new Map,this.requestsOlderThanRestart=new Set}request(e,t){let r=new Promise(r=>{this.inflightRequests.set(e.requestId,{message:e,status:{status:t?"Requested":"NotSent",requestedAt:new Date,onResult:r}}),"Mutation"===e.type?this.inflightMutationsCount++:"Action"===e.type&&this.inflightActionsCount++});return this.markConnectionStateDirty(),r}onResponse(e){let t,r;let s=this.inflightRequests.get(e.requestId);if(void 0===s||"Completed"===s.status.status)return null;let o="Mutation"===s.message.type?"mutation":"action",a=s.message.udfPath;for(let t of e.logLines)(0,i.logForFunction)(this.logger,"info",o,a,t);let l=s.status;if(e.success)t={success:!0,logLines:e.logLines,value:(0,n.jsonToConvex)(e.result)},r=()=>l.onResult(t);else{let s=e.result,{errorData:u}=e;(0,i.logForFunction)(this.logger,"error",o,a,s),t={success:!1,errorMessage:s,errorData:void 0!==u?(0,n.jsonToConvex)(u):void 0,logLines:e.logLines},r=()=>l.onResult(t)}return"ActionResponse"!==e.type&&e.success?(s.status={status:"Completed",result:t,ts:e.ts,onResolve:r},null):(r(),this.inflightRequests.delete(e.requestId),this.requestsOlderThanRestart.delete(e.requestId),"Action"===s.message.type?this.inflightActionsCount--:"Mutation"===s.message.type&&this.inflightMutationsCount--,this.markConnectionStateDirty(),{requestId:e.requestId,result:t})}removeCompleted(e){let t=new Map;for(let[r,s]of this.inflightRequests.entries()){let n=s.status;"Completed"===n.status&&n.ts.lessThanOrEqual(e)&&(n.onResolve(),t.set(r,n.result),"Mutation"===s.message.type?this.inflightMutationsCount--:"Action"===s.message.type&&this.inflightActionsCount--,this.inflightRequests.delete(r),this.requestsOlderThanRestart.delete(r))}return t.size>0&&this.markConnectionStateDirty(),t}restart(){this.requestsOlderThanRestart=new Set(this.inflightRequests.keys());let e=[];for(let[t,r]of this.inflightRequests){if("NotSent"===r.status.status){r.status.status="Requested",e.push(r.message);continue}if("Mutation"===r.message.type)e.push(r.message);else if("Action"===r.message.type){if(this.inflightRequests.delete(t),this.requestsOlderThanRestart.delete(t),this.inflightActionsCount--,"Completed"===r.status.status)throw Error("Action should never be in 'Completed' state");r.status.onResult({success:!1,errorMessage:"Connection lost while action was in flight",logLines:[]})}}return this.markConnectionStateDirty(),e}resume(){let e=[];for(let[,t]of this.inflightRequests)if("NotSent"===t.status.status){t.status.status="Requested",e.push(t.message);continue}return e}hasIncompleteRequests(){for(let e of this.inflightRequests.values())if("Requested"===e.status.status)return!0;return!1}hasInflightRequests(){return this.inflightRequests.size>0}hasSyncedPastLastReconnect(){return 0===this.requestsOlderThanRestart.size}timeOfOldestInflightRequest(){if(0===this.inflightRequests.size)return null;let e=Date.now();for(let t of this.inflightRequests.values())"Completed"!==t.status.status&&t.status.requestedAt.getTime()<e&&(e=t.status.requestedAt.getTime());return new Date(e)}inflightMutations(){return this.inflightMutationsCount}inflightActions(){return this.inflightActionsCount}}},{"../../values/index.js":"dViyc","../logging.js":"5I2B4","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],ulkb2:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"OptimisticQueryResults",()=>p);var n=e("../../server/api.js"),i=e("../../common/index.js"),o=e("../logging.js"),a=e("./udf_path_utils.js"),l=e("../../values/errors.js"),u=Object.defineProperty,c=(e,t,r)=>t in e?u(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,h=(e,t,r)=>c(e,"symbol"!=typeof t?t+"":t,r);class d{constructor(e){h(this,"queryResults"),h(this,"modifiedQueries"),this.queryResults=e,this.modifiedQueries=[]}getQuery(e,...t){let r=(0,i.parseArgs)(t[0]),s=(0,n.getFunctionName)(e),o=this.queryResults.get((0,a.serializePathAndArgs)(s,r));if(void 0!==o)return d.queryValue(o.result)}getAllQueries(e){let t=[],r=(0,n.getFunctionName)(e);for(let e of this.queryResults.values())e.udfPath===(0,a.canonicalizeUdfPath)(r)&&t.push({args:e.args,value:d.queryValue(e.result)});return t}setQuery(e,t,r){let s=(0,i.parseArgs)(t),o=(0,n.getFunctionName)(e),l=(0,a.serializePathAndArgs)(o,s);this.queryResults.set(l,{udfPath:o,args:s,result:void 0===r?void 0:{success:!0,value:r,logLines:[]}}),this.modifiedQueries.push(l)}static queryValue(e){return void 0===e?void 0:e.success?e.value:void 0}}class p{constructor(){h(this,"queryResults"),h(this,"optimisticUpdates"),this.queryResults=new Map,this.optimisticUpdates=[]}ingestQueryResultsFromServer(e,t){this.optimisticUpdates=this.optimisticUpdates.filter(e=>!t.has(e.mutationId));let r=this.queryResults;this.queryResults=new Map(e);let s=new d(this.queryResults);for(let e of this.optimisticUpdates)e.update(s);let n=[];for(let[e,t]of this.queryResults){let s=r.get(e);(void 0===s||s.result!==t.result)&&n.push(e)}return n}applyOptimisticUpdate(e,t){this.optimisticUpdates.push({update:e,mutationId:t});let r=new d(this.queryResults);return e(r),r.modifiedQueries}rawQueryResult(e){let t=this.queryResults.get(e);if(void 0!==t)return t.result}queryResult(e){let t=this.queryResults.get(e);if(void 0===t)return;let r=t.result;if(void 0!==r){if(r.success)return r.value;if(void 0!==r.errorData)throw(0,o.forwardData)(r,new l.ConvexError((0,o.createHybridErrorStacktrace)("query",t.udfPath,r)));throw Error((0,o.createHybridErrorStacktrace)("query",t.udfPath,r))}}hasQueryResult(e){return void 0!==this.queryResults.get(e)}queryLogs(e){let t=this.queryResults.get(e);return t?.result?.logLines}}},{"../../server/api.js":"cQjid","../../common/index.js":"l8P8A","../logging.js":"5I2B4","./udf_path_utils.js":"bhVyA","../../values/errors.js":"dS3IT","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],cQjid:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"getFunctionName",()=>o),s.export(r,"makeFunctionReference",()=>a),s.export(r,"filterApi",()=>l),s.export(r,"justInternal",()=>u),s.export(r,"justPublic",()=>c),s.export(r,"justQueries",()=>h),s.export(r,"justMutations",()=>d),s.export(r,"justActions",()=>p),s.export(r,"justPaginatedQueries",()=>f),s.export(r,"justSchedulable",()=>g),s.export(r,"anyApi",()=>m);var n=e("./functionName.js"),i=e("./components/paths.js");function o(e){let t=(0,i.getFunctionAddress)(e);if(void 0===t.name){if(void 0!==t.functionHandle)throw Error(`Expected function reference like "api.file.func" or "internal.file.func", but received function handle ${t.functionHandle}`);if(void 0!==t.reference)throw Error(`Expected function reference in the current component like "api.file.func" or "internal.file.func", but received reference ${t.reference}`);throw Error(`Expected function reference like "api.file.func" or "internal.file.func", but received ${JSON.stringify(t)}`)}if("string"==typeof e)return e;let r=e[n.functionName];if(!r)throw Error(`${e} is not a functionReference`);return r}function a(e){return{[n.functionName]:e}}function l(e){return e}function u(e){return e}function c(e){return e}function h(e){return e}function d(e){return e}function p(e){return e}function f(e){return e}function g(e){return e}let m=function e(t=[]){return new Proxy({},{get(r,s){if("string"==typeof s){let r=[...t,s];return e(r)}if(s===n.functionName){if(t.length<2){let e=["api",...t].join(".");throw Error(`API path is expected to be of the form \`api.moduleName.functionName\`. Found: \`${e}\``)}let e=t.slice(0,-1).join("/"),r=t[t.length-1];return"default"===r?e:e+":"+r}return s===Symbol.toStringTag?"FunctionReference":void 0}})}()},{"./functionName.js":"j10lt","./components/paths.js":"5wHBq","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],j10lt:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"functionName",()=>n);let n=Symbol.for("functionName")},{"@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],"5wHBq":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"toReferencePath",()=>i),s.export(r,"setReferencePath",()=>o),s.export(r,"extractReferencePath",()=>a),s.export(r,"isFunctionHandle",()=>l),s.export(r,"getFunctionAddress",()=>u);var n=e("../functionName.js");let i=Symbol.for("toReferencePath");function o(e,t){e[i]=t}function a(e){return e[i]??null}function l(e){return e.startsWith("function://")}function u(e){let t;if("string"==typeof e)t=l(e)?{functionHandle:e}:{name:e};else if(e[n.functionName])t={name:e[n.functionName]};else{let r=a(e);if(!r)throw Error(`${e} is not a functionReference`);t={reference:r}}return t}},{"../functionName.js":"j10lt","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],i42ba:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"RemoteQuerySet",()=>c);var n=e("../../values/index.js"),i=e("../../vendor/long.js"),o=e("../logging.js"),a=Object.defineProperty,l=(e,t,r)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,u=(e,t,r)=>l(e,"symbol"!=typeof t?t+"":t,r);class c{constructor(e,t){u(this,"version"),u(this,"remoteQuerySet"),u(this,"queryPath"),u(this,"logger"),this.version={querySet:0,ts:(0,i.Long).fromNumber(0),identity:0},this.remoteQuerySet=new Map,this.queryPath=e,this.logger=t}transition(e){let t=e.startVersion;if(this.version.querySet!==t.querySet||this.version.ts.notEquals(t.ts)||this.version.identity!==t.identity)throw Error(`Invalid start version: ${t.ts.toString()}:${t.querySet}:${t.identity}, transitioning from ${this.version.ts.toString()}:${this.version.querySet}:${this.version.identity}`);for(let t of e.modifications)switch(t.type){case"QueryUpdated":{let e=this.queryPath(t.queryId);if(e)for(let r of t.logLines)(0,o.logForFunction)(this.logger,"info","query",e,r);let r=(0,n.jsonToConvex)(t.value??null);this.remoteQuerySet.set(t.queryId,{success:!0,value:r,logLines:t.logLines});break}case"QueryFailed":{let e=this.queryPath(t.queryId);if(e)for(let r of t.logLines)(0,o.logForFunction)(this.logger,"info","query",e,r);let{errorData:r}=t;this.remoteQuerySet.set(t.queryId,{success:!1,errorMessage:t.errorMessage,errorData:void 0!==r?(0,n.jsonToConvex)(r):void 0,logLines:t.logLines});break}case"QueryRemoved":this.remoteQuerySet.delete(t.queryId);break;default:throw Error(`Invalid modification ${t.type}`)}this.version=e.endVersion}remoteQueryResults(){return this.remoteQuerySet}timestamp(){return this.version.ts}}},{"../../values/index.js":"dViyc","../../vendor/long.js":"heN3C","../logging.js":"5I2B4","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],heN3C:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"Long",()=>a);var n=Object.defineProperty,i=(e,t,r)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,o=(e,t,r)=>i(e,"symbol"!=typeof t?t+"":t,r);class a{constructor(e,t){o(this,"low"),o(this,"high"),o(this,"__isUnsignedLong__"),this.low=0|e,this.high=0|t,this.__isUnsignedLong__=!0}static isLong(e){return!0===(e&&e.__isUnsignedLong__)}static fromBytesLE(e){return new a(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24)}toBytesLE(){let e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]}static fromNumber(e){return isNaN(e)||e<0?l:e>=c?h:new a(e%u|0,e/u|0)}toString(){return(BigInt(this.high)*BigInt(u)+BigInt(this.low)).toString()}equals(e){return a.isLong(e)||(e=a.fromValue(e)),(this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low}notEquals(e){return!this.equals(e)}comp(e){return(a.isLong(e)||(e=a.fromValue(e)),this.equals(e))?0:e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1}lessThanOrEqual(e){return 0>=this.comp(e)}static fromValue(e){return"number"==typeof e?a.fromNumber(e):new a(e.low,e.high)}}let l=new a(0,0),u=4294967296,c=u*u,h=new a(-1,-1)},{"@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],laM6w:[function(e,t,r){let s;var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r),n.export(r,"WebSocketManager",()=>d);var i=e("./protocol.js"),o=Object.defineProperty,a=(e,t,r)=>t in e?o(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,l=(e,t,r)=>a(e,"symbol"!=typeof t?t+"":t,r);function u(){return(void 0===s&&(s=Date.now()),"undefined"!=typeof performance&&performance.now)?Math.round(s+performance.now()):Date.now()}function c(){return`t=${Math.round((u()-s)/100)/10}s`}let h={InternalServerError:{timeout:1e3},SubscriptionsWorkerFullError:{timeout:3e3},TooManyConcurrentRequests:{timeout:3e3},CommitterFullError:{timeout:3e3},AwsTooManyRequestsException:{timeout:3e3},ExecuteFullError:{timeout:3e3},SystemTimeoutError:{timeout:3e3},ExpiredInQueue:{timeout:3e3},VectorIndexesUnavailable:{timeout:1e3},SearchIndexesUnavailable:{timeout:1e3},TableSummariesUnavailable:{timeout:1e3},VectorIndexTooLarge:{timeout:3e3},SearchIndexTooLarge:{timeout:3e3},TooManyWritesInTimePeriod:{timeout:3e3}};class d{constructor(e,t,r,s,n,i){this.markConnectionStateDirty=n,this.debug=i,l(this,"socket"),l(this,"connectionCount"),l(this,"_hasEverConnected",!1),l(this,"lastCloseReason"),l(this,"transitionChunkBuffer",null),l(this,"defaultInitialBackoff"),l(this,"maxBackoff"),l(this,"retries"),l(this,"serverInactivityThreshold"),l(this,"reconnectDueToServerInactivityTimeout"),l(this,"uri"),l(this,"onOpen"),l(this,"onResume"),l(this,"onMessage"),l(this,"webSocketConstructor"),l(this,"logger"),l(this,"onServerDisconnectError"),this.webSocketConstructor=r,this.socket={state:"disconnected"},this.connectionCount=0,this.lastCloseReason="InitialConnect",this.defaultInitialBackoff=1e3,this.maxBackoff=16e3,this.retries=0,this.serverInactivityThreshold=6e4,this.reconnectDueToServerInactivityTimeout=null,this.uri=e,this.onOpen=t.onOpen,this.onResume=t.onResume,this.onMessage=t.onMessage,this.onServerDisconnectError=t.onServerDisconnectError,this.logger=s,this.connect()}setSocketState(e){this.socket=e,this._logVerbose(`socket state changed: ${this.socket.state}, paused: ${"paused"in this.socket?this.socket.paused:void 0}`),this.markConnectionStateDirty()}assembleTransition(e){if(e.partNumber<0||e.partNumber>=e.totalParts||0===e.totalParts||this.transitionChunkBuffer&&(this.transitionChunkBuffer.totalParts!==e.totalParts||this.transitionChunkBuffer.transitionId!==e.transitionId))throw this.transitionChunkBuffer=null,Error("Invalid TransitionChunk");if(null===this.transitionChunkBuffer&&(this.transitionChunkBuffer={chunks:[],totalParts:e.totalParts,transitionId:e.transitionId}),e.partNumber!==this.transitionChunkBuffer.chunks.length){let t=this.transitionChunkBuffer.chunks.length;throw this.transitionChunkBuffer=null,Error(`TransitionChunk received out of order: expected part ${t}, got ${e.partNumber}`)}if(this.transitionChunkBuffer.chunks.push(e.chunk),this.transitionChunkBuffer.chunks.length===e.totalParts){let e=this.transitionChunkBuffer.chunks.join("");this.transitionChunkBuffer=null;let t=(0,i.parseServerMessage)(JSON.parse(e));if("Transition"!==t.type)throw Error(`Expected Transition, got ${t.type} after assembling chunks`);return t}return null}connect(){if("terminated"===this.socket.state)return;if("disconnected"!==this.socket.state&&"stopped"!==this.socket.state)throw Error("Didn't start connection from disconnected state: "+this.socket.state);let e=new this.webSocketConstructor(this.uri);this._logVerbose("constructed WebSocket"),this.setSocketState({state:"connecting",ws:e,paused:"no"}),this.resetServerInactivityTimeout(),e.onopen=()=>{if(this.logger.logVerbose("begin ws.onopen"),"connecting"!==this.socket.state)throw Error("onopen called with socket not in connecting state");this.setSocketState({state:"ready",ws:e,paused:"yes"===this.socket.paused?"uninitialized":"no"}),this.resetServerInactivityTimeout(),"no"===this.socket.paused&&(this._hasEverConnected=!0,this.onOpen({connectionCount:this.connectionCount,lastCloseReason:this.lastCloseReason,clientTs:u()})),"InitialConnect"!==this.lastCloseReason&&(this.lastCloseReason?this.logger.log("WebSocket reconnected at",c(),"after disconnect due to",this.lastCloseReason):this.logger.log("WebSocket reconnected at",c())),this.connectionCount+=1,this.lastCloseReason=null},e.onerror=e=>{this.transitionChunkBuffer=null;let t=e.message;t&&this.logger.log(`WebSocket error message: ${t}`)},e.onmessage=e=>{this.resetServerInactivityTimeout();let t=e.data.length,r=(0,i.parseServerMessage)(JSON.parse(e.data));if(this._logVerbose(`received ws message with type ${r.type}`),"Ping"===r.type)return;if("TransitionChunk"===r.type){let e=this.assembleTransition(r);if(!e)return;r=e,this._logVerbose(`assembled full ws message of type ${r.type}`)}null!==this.transitionChunkBuffer&&(this.transitionChunkBuffer=null,this.logger.log(`Received unexpected ${r.type} while buffering TransitionChunks`)),"Transition"===r.type&&this.reportLargeTransition({messageLength:t,transition:r});let s=this.onMessage(r);s.hasSyncedPastLastReconnect&&(this.retries=0,this.markConnectionStateDirty())},e.onclose=e=>{if(this._logVerbose("begin ws.onclose"),this.transitionChunkBuffer=null,null===this.lastCloseReason&&(this.lastCloseReason=e.reason||`closed with code ${e.code}`),1e3!==e.code&&1001!==e.code&&1005!==e.code&&4040!==e.code){let t=`WebSocket closed with code ${e.code}`;e.reason&&(t+=`: ${e.reason}`),this.logger.log(t),this.onServerDisconnectError&&e.reason&&this.onServerDisconnectError(t)}let t=function(e){if(void 0===e)return"Unknown";for(let t of Object.keys(h))if(e.startsWith(t))return t;return"Unknown"}(e.reason);this.scheduleReconnect(t)}}socketState(){return this.socket.state}sendMessage(e){let t={type:e.type,..."Authenticate"===e.type&&"User"===e.tokenType?{value:`...${e.value.slice(-7)}`}:{}};if("ready"===this.socket.state&&"no"===this.socket.paused){let r=(0,i.encodeClientMessage)(e),s=JSON.stringify(r),n=!1;try{this.socket.ws.send(s),n=!0}catch(e){this.logger.log(`Failed to send message on WebSocket, reconnecting: ${e}`),this.closeAndReconnect("FailedToSendMessage")}return this._logVerbose(`${n?"sent":"failed to send"} message with type ${e.type}: ${JSON.stringify(t)}`),!0}return this._logVerbose(`message not sent (socket state: ${this.socket.state}, paused: ${"paused"in this.socket?this.socket.paused:void 0}): ${JSON.stringify(t)}`),!1}resetServerInactivityTimeout(){"terminated"!==this.socket.state&&(null!==this.reconnectDueToServerInactivityTimeout&&(clearTimeout(this.reconnectDueToServerInactivityTimeout),this.reconnectDueToServerInactivityTimeout=null),this.reconnectDueToServerInactivityTimeout=setTimeout(()=>{this.closeAndReconnect("InactiveServer")},this.serverInactivityThreshold))}scheduleReconnect(e){this.socket={state:"disconnected"};let t=this.nextBackoff(e);this.markConnectionStateDirty(),this.logger.log(`Attempting reconnect in ${Math.round(t)}ms`),setTimeout(()=>this.connect(),t)}closeAndReconnect(e){switch(this._logVerbose(`begin closeAndReconnect with reason ${e}`),this.socket.state){case"disconnected":case"terminated":case"stopped":return;case"connecting":case"ready":this.lastCloseReason=e,this.close(),this.scheduleReconnect("client");return;default:this.socket}}close(){switch(this.transitionChunkBuffer=null,this.socket.state){case"disconnected":case"terminated":case"stopped":return Promise.resolve();case"connecting":{let e=this.socket.ws;return e.onmessage=e=>{this._logVerbose("Ignoring message received after close")},new Promise(t=>{e.onclose=()=>{this._logVerbose("Closed after connecting"),t()},e.onopen=()=>{this._logVerbose("Opened after connecting"),e.close()}})}case"ready":{this._logVerbose("ws.close called");let e=this.socket.ws;e.onmessage=e=>{this._logVerbose("Ignoring message received after close")};let t=new Promise(t=>{e.onclose=()=>{t()}});return e.close(),t}default:return this.socket,Promise.resolve()}}terminate(){switch(this.reconnectDueToServerInactivityTimeout&&clearTimeout(this.reconnectDueToServerInactivityTimeout),this.socket.state){case"terminated":case"stopped":case"disconnected":case"connecting":case"ready":{let e=this.close();return this.setSocketState({state:"terminated"}),e}default:throw this.socket,Error(`Invalid websocket state: ${this.socket.state}`)}}stop(){switch(this.socket.state){case"terminated":return Promise.resolve();case"connecting":case"stopped":case"disconnected":case"ready":{let e=this.close();return this.socket={state:"stopped"},e}default:return this.socket,Promise.resolve()}}tryRestart(){switch(this.socket.state){case"stopped":break;case"terminated":case"connecting":case"ready":case"disconnected":this.logger.logVerbose("Restart called without stopping first");return;default:this.socket}this.connect()}pause(){switch(this.socket.state){case"disconnected":case"stopped":case"terminated":return;case"connecting":case"ready":this.socket={...this.socket,paused:"yes"};return;default:this.socket;return}}resume(){switch(this.socket.state){case"connecting":this.socket={...this.socket,paused:"no"};return;case"ready":"uninitialized"===this.socket.paused?(this.socket={...this.socket,paused:"no"},this.onOpen({connectionCount:this.connectionCount,lastCloseReason:this.lastCloseReason,clientTs:u()})):"yes"===this.socket.paused&&(this.socket={...this.socket,paused:"no"},this.onResume());return;case"terminated":case"stopped":case"disconnected":return;default:this.socket}this.connect()}connectionState(){return{isConnected:"ready"===this.socket.state,hasEverConnected:this._hasEverConnected,connectionCount:this.connectionCount,connectionRetries:this.retries}}_logVerbose(e){this.logger.logVerbose(e)}nextBackoff(e){let t="client"===e?100:"Unknown"===e?this.defaultInitialBackoff:h[e].timeout,r=t*Math.pow(2,this.retries);this.retries+=1;let s=Math.min(r,this.maxBackoff);return s+s*(Math.random()-.5)}reportLargeTransition({transition:e,messageLength:t}){if(void 0===e.clientClockSkew||void 0===e.serverTs)return;let r=u()-e.clientClockSkew-e.serverTs/1e6,s=`${Math.round(r)}ms`,n=`${Math.round(t/1e4)/100}MB`,i=t/(r/1e3),o=`${Math.round(i/1e4)/100}MB per second`;this._logVerbose(`received ${n} transition in ${s} at ${o}`),t>2e7?this.logger.log(`received query results totaling more that 20MB (${n}) which will take a long time to download on slower connections`):r>2e4&&this.logger.log(`received query results totaling ${n} which took more than 20s to arrive (${s})`),this.debug&&this.sendMessage({type:"Event",eventType:"ClientReceivedTransition",event:{transitionTransitTime:r,messageLength:t}})}}},{"./protocol.js":"jHoGX","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],jHoGX:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"u64ToLong",()=>o),s.export(r,"longToU64",()=>a),s.export(r,"parseServerMessage",()=>l),s.export(r,"encodeClientMessage",()=>u);var n=e("../../values/index.js"),i=e("../../vendor/long.js");function o(e){let t=(0,n.Base64).toByteArray(e);return(0,i.Long).fromBytesLE(Array.from(t))}function a(e){let t=new Uint8Array(e.toBytesLE());return(0,n.Base64).fromByteArray(t)}function l(e){switch(e.type){case"FatalError":case"AuthError":case"ActionResponse":case"TransitionChunk":case"Ping":return{...e};case"MutationResponse":if(e.success)return{...e,ts:o(e.ts)};return{...e};case"Transition":return{...e,startVersion:{...e.startVersion,ts:o(e.startVersion.ts)},endVersion:{...e.endVersion,ts:o(e.endVersion.ts)}}}}function u(e){switch(e.type){case"Authenticate":case"ModifyQuerySet":case"Mutation":case"Action":case"Event":return{...e};case"Connect":if(void 0!==e.maxObservedTimestamp)return{...e,maxObservedTimestamp:a(e.maxObservedTimestamp)};return{...e,maxObservedTimestamp:void 0}}}},{"../../values/index.js":"dViyc","../../vendor/long.js":"heN3C","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],aQJw1:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");function n(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}s.defineInteropFlag(r),s.export(r,"newSessionId",()=>n)},{"@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],gNSME:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"AuthenticationManager",()=>l);var n=e("../../vendor/jwt-decode/index.js"),i=Object.defineProperty,o=(e,t,r)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,a=(e,t,r)=>o(e,"symbol"!=typeof t?t+"":t,r);class l{constructor(e,t,r){a(this,"authState",{state:"noAuth"}),a(this,"configVersion",0),a(this,"syncState"),a(this,"authenticate"),a(this,"stopSocket"),a(this,"tryRestartSocket"),a(this,"pauseSocket"),a(this,"resumeSocket"),a(this,"clearAuth"),a(this,"logger"),a(this,"refreshTokenLeewaySeconds"),a(this,"tokenConfirmationAttempts",0),this.syncState=e,this.authenticate=t.authenticate,this.stopSocket=t.stopSocket,this.tryRestartSocket=t.tryRestartSocket,this.pauseSocket=t.pauseSocket,this.resumeSocket=t.resumeSocket,this.clearAuth=t.clearAuth,this.logger=r.logger,this.refreshTokenLeewaySeconds=r.refreshTokenLeewaySeconds}async setConfig(e,t){this.resetAuthState(),this._logVerbose("pausing WS for auth token fetch"),this.pauseSocket();let r=await this.fetchTokenAndGuardAgainstRace(e,{forceRefreshToken:!1});r.isFromOutdatedConfig||(r.value?(this.setAuthState({state:"waitingForServerConfirmationOfCachedToken",config:{fetchToken:e,onAuthChange:t},hasRetried:!1}),this.authenticate(r.value)):(this.setAuthState({state:"initialRefetch",config:{fetchToken:e,onAuthChange:t}}),await this.refetchToken()),this._logVerbose("resuming WS after auth token fetch"),this.resumeSocket())}onTransition(e){if(this.syncState.isCurrentOrNewerAuthVersion(e.endVersion.identity)&&!(e.endVersion.identity<=e.startVersion.identity)){if("waitingForServerConfirmationOfCachedToken"===this.authState.state){this._logVerbose("server confirmed auth token is valid"),this.refetchToken(),this.authState.config.onAuthChange(!0);return}"waitingForServerConfirmationOfFreshToken"!==this.authState.state||(this._logVerbose("server confirmed new auth token is valid"),this.scheduleTokenRefetch(this.authState.token),this.tokenConfirmationAttempts=0,this.authState.hadAuth||this.authState.config.onAuthChange(!0))}}onAuthError(e){if(!1===e.authUpdateAttempted&&("waitingForServerConfirmationOfFreshToken"===this.authState.state||"waitingForServerConfirmationOfCachedToken"===this.authState.state)){this._logVerbose("ignoring non-auth token expired error");return}let{baseVersion:t}=e;if(!this.syncState.isCurrentOrNewerAuthVersion(t+1)){this._logVerbose("ignoring auth error for previous auth attempt");return}this.tryToReauthenticate(e)}async tryToReauthenticate(e){if(this._logVerbose(`attempting to reauthenticate: ${e.error}`),"noAuth"===this.authState.state||"waitingForServerConfirmationOfFreshToken"===this.authState.state&&this.tokenConfirmationAttempts>=2){this.logger.error(`Failed to authenticate: "${e.error}", check your server auth config`),this.syncState.hasAuth()&&this.syncState.clearAuth(),"noAuth"!==this.authState.state&&this.setAndReportAuthFailed(this.authState.config.onAuthChange);return}"waitingForServerConfirmationOfFreshToken"===this.authState.state&&(this.tokenConfirmationAttempts++,this._logVerbose(`retrying reauthentication, ${2-this.tokenConfirmationAttempts} attempts remaining`)),await this.stopSocket();let t=await this.fetchTokenAndGuardAgainstRace(this.authState.config.fetchToken,{forceRefreshToken:!0});t.isFromOutdatedConfig||(t.value&&this.syncState.isNewAuth(t.value)?(this.authenticate(t.value),this.setAuthState({state:"waitingForServerConfirmationOfFreshToken",config:this.authState.config,token:t.value,hadAuth:"notRefetching"===this.authState.state||"waitingForScheduledRefetch"===this.authState.state})):(this._logVerbose("reauthentication failed, could not fetch a new token"),this.syncState.hasAuth()&&this.syncState.clearAuth(),this.setAndReportAuthFailed(this.authState.config.onAuthChange)),this.tryRestartSocket())}async refetchToken(){if("noAuth"===this.authState.state)return;this._logVerbose("refetching auth token");let e=await this.fetchTokenAndGuardAgainstRace(this.authState.config.fetchToken,{forceRefreshToken:!0});e.isFromOutdatedConfig||(e.value?this.syncState.isNewAuth(e.value)?(this.setAuthState({state:"waitingForServerConfirmationOfFreshToken",hadAuth:this.syncState.hasAuth(),token:e.value,config:this.authState.config}),this.authenticate(e.value)):this.setAuthState({state:"notRefetching",config:this.authState.config}):(this._logVerbose("refetching token failed"),this.syncState.hasAuth()&&this.clearAuth(),this.setAndReportAuthFailed(this.authState.config.onAuthChange)),this._logVerbose("restarting WS after auth token fetch (if currently stopped)"),this.tryRestartSocket())}scheduleTokenRefetch(e){if("noAuth"===this.authState.state)return;let t=this.decodeToken(e);if(!t){this.logger.error("Auth token is not a valid JWT, cannot refetch the token");return}let{iat:r,exp:s}=t;if(!r||!s){this.logger.error("Auth token does not have required fields, cannot refetch the token");return}let n=s-r;if(n<=2){this.logger.error("Auth token does not live long enough, cannot refetch the token");return}let i=Math.min(1728e6,(n-this.refreshTokenLeewaySeconds)*1e3);i<=0&&(this.logger.warn(`Refetching auth token immediately, configured leeway ${this.refreshTokenLeewaySeconds}s is larger than the token's lifetime ${n}s`),i=0);let o=setTimeout(()=>{this._logVerbose("running scheduled token refetch"),this.refetchToken()},i);this.setAuthState({state:"waitingForScheduledRefetch",refetchTokenTimeoutId:o,config:this.authState.config}),this._logVerbose(`scheduled preemptive auth token refetching in ${i}ms`)}async fetchTokenAndGuardAgainstRace(e,t){let r=++this.configVersion;this._logVerbose(`fetching token with config version ${r}`);let s=await e(t);return this.configVersion!==r?(this._logVerbose(`stale config version, expected ${r}, got ${this.configVersion}`),{isFromOutdatedConfig:!0}):{isFromOutdatedConfig:!1,value:s}}stop(){this.resetAuthState(),this.configVersion++,this._logVerbose(`config version bumped to ${this.configVersion}`)}setAndReportAuthFailed(e){e(!1),this.resetAuthState()}resetAuthState(){this.setAuthState({state:"noAuth"})}setAuthState(e){let t="waitingForServerConfirmationOfFreshToken"===e.state?{hadAuth:e.hadAuth,state:e.state,token:`...${e.token.slice(-7)}`}:{state:e.state};switch(this._logVerbose(`setting auth state to ${JSON.stringify(t)}`),e.state){case"waitingForScheduledRefetch":case"notRefetching":case"noAuth":this.tokenConfirmationAttempts=0}"waitingForScheduledRefetch"===this.authState.state&&(clearTimeout(this.authState.refetchTokenTimeoutId),this.syncState.markAuthCompletion()),this.authState=e}decodeToken(e){try{return(0,n.jwtDecode)(e)}catch(e){return this._logVerbose(`Error decoding token: ${e instanceof Error?e.message:"Unknown error"}`),null}}_logVerbose(e){this.logger.logVerbose(`${e} [v${this.configVersion}]`)}}},{"../../vendor/jwt-decode/index.js":"j0Zfh","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],j0Zfh:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"InvalidTokenError",()=>n),s.export(r,"jwtDecode",()=>i);class n extends Error{}function i(e,t){let r;if("string"!=typeof e)throw new n("Invalid token specified: must be a string");t||(t={});let s=!0===t.header?0:1,i=e.split(".")[s];if("string"!=typeof i)throw new n(`Invalid token specified: missing part #${s+1}`);try{r=function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw Error("base64 string is not of the correct length")}try{var r;return r=t,decodeURIComponent(atob(r).replace(/(.)/g,(e,t)=>{let r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}catch{return atob(t)}}(i)}catch(e){throw new n(`Invalid token specified: invalid base64 for part #${s+1} (${e.message})`)}try{return JSON.parse(r)}catch(e){throw new n(`Invalid token specified: invalid json for part #${s+1} (${e.message})`)}}n.prototype.name="InvalidTokenError"},{"@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],iY5md:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"mark",()=>i),s.export(r,"getMarksReport",()=>a);let n=["convexClientConstructed","convexWebSocketOpen","convexFirstMessageReceived"];function i(e,t){"undefined"!=typeof performance&&performance.mark&&performance.mark(e,{detail:{sessionId:t}})}function o(e){let t=e.name.slice(6);return{name:t=t.charAt(0).toLowerCase()+t.slice(1),startTime:e.startTime}}function a(e){if("undefined"==typeof performance||!performance.getEntriesByName)return[];let t=[];for(let r of n){let s=performance.getEntriesByName(r).filter(e=>"mark"===e.entryType).filter(t=>t.detail.sessionId===e);t.push(...s)}return t.map(o)}},{"@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],"3gW31":[function(e,t,r){let s;var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r),n.export(r,"setDefaultWebSocketConstructor",()=>p),n.export(r,"ConvexClient",()=>f);var i=e("../common/index.js"),o=e("./index.js"),a=e("../server/api.js"),l=e("./sync/paginated_query_client.js"),u=e("./sync/udf_path_utils.js"),c=Object.defineProperty,h=(e,t,r)=>t in e?c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,d=(e,t,r)=>h(e,"symbol"!=typeof t?t+"":t,r);function p(e){s=e}class f{constructor(e,t={}){d(this,"listeners"),d(this,"_client"),d(this,"_paginatedClient"),d(this,"callNewListenersWithCurrentValuesTimer"),d(this,"_closed"),d(this,"_disabled"),!0!==t.skipConvexDeploymentUrlCheck&&(0,i.validateDeploymentUrl)(e);let{disabled:r,...n}=t;this._closed=!1,this._disabled=!!r,!s||"webSocketConstructor"in n||"undefined"!=typeof WebSocket||(n.webSocketConstructor=s),"undefined"!=typeof window||"unsavedChangesWarning"in n||(n.unsavedChangesWarning=!1),this.disabled||(this._client=new o.BaseConvexClient(e,()=>{},n),this._paginatedClient=new l.PaginatedQueryClient(this._client,e=>this._transition(e))),this.listeners=new Set}get closed(){return this._closed}get client(){if(this._client)return this._client;throw Error("ConvexClient is disabled")}get paginatedClient(){if(this._paginatedClient)return this._paginatedClient;throw Error("ConvexClient is disabled")}get disabled(){return this._disabled}onUpdate(e,t,r,s){if(this.disabled)return this.createDisabledUnsubscribe();let{queryToken:n,unsubscribe:i}=this.client.subscribe((0,a.getFunctionName)(e),t),o={queryToken:n,callback:r,onError:s,unsubscribe:i,hasEverRun:!1,query:e,args:t,paginationOptions:void 0};this.listeners.add(o),this.queryResultReady(n)&&void 0===this.callNewListenersWithCurrentValuesTimer&&(this.callNewListenersWithCurrentValuesTimer=setTimeout(()=>this.callNewListenersWithCurrentValues(),0));let l={unsubscribe:()=>{this.closed||(this.listeners.delete(o),i())},getCurrentValue:()=>this.client.localQueryResultByToken(n),getQueryLogs:()=>this.client.localQueryLogs(n)},u=l.unsubscribe;return Object.assign(u,l),u}onPaginatedUpdate_experimental(e,t,r,s,n){if(this.disabled)return this.createDisabledUnsubscribe();let i={initialNumItems:r.initialNumItems,id:-1},{paginatedQueryToken:o,unsubscribe:l}=this.paginatedClient.subscribe((0,a.getFunctionName)(e),t,i),u={queryToken:o,callback:s,onError:n,unsubscribe:l,hasEverRun:!1,query:e,args:t,paginationOptions:i};this.listeners.add(u),this.paginatedClient.localQueryResultByToken(o)&&void 0===this.callNewListenersWithCurrentValuesTimer&&(this.callNewListenersWithCurrentValuesTimer=setTimeout(()=>this.callNewListenersWithCurrentValues(),0));let c={unsubscribe:()=>{this.closed||(this.listeners.delete(u),l())},getCurrentValue:()=>{let r=this.paginatedClient.localQueryResult((0,a.getFunctionName)(e),t,i);return r},getQueryLogs:()=>[]},h=c.unsubscribe;return Object.assign(h,c),h}callNewListenersWithCurrentValues(){this.callNewListenersWithCurrentValuesTimer=void 0,this._transition({queries:[],paginatedQueries:[]},!0)}queryResultReady(e){return this.client.hasLocalQueryResultByToken(e)}createDisabledUnsubscribe(){let e=()=>{};return Object.assign(e,{unsubscribe:e,getCurrentValue:()=>void 0,getQueryLogs:()=>void 0}),e}async close(){if(!this.disabled)return this.listeners.clear(),this._closed=!0,this._paginatedClient&&(this._paginatedClient=void 0),this.client.close()}getAuth(){if(!this.disabled)return this.client.getCurrentAuthClaims()}setAuth(e,t){this.disabled||this.client.setAuth(e,t??(()=>{}))}setAdminAuth(e,t){if(this.closed)throw Error("ConvexClient has already been closed.");this.disabled||this.client.setAdminAuth(e,t)}_transition({queries:e,paginatedQueries:t},r=!1){let s=[...e.map(e=>e.token),...t.map(e=>e.token)];for(let e of this.listeners){let{callback:t,queryToken:n,onError:i,hasEverRun:o}=e,a=(0,u.serializedQueryTokenIsPaginated)(n),l=a?!!this.paginatedClient.localQueryResultByToken(n):this.client.hasLocalQueryResultByToken(n);if(s.includes(n)||r&&!o&&l){let r;e.hasEverRun=!0;try{r=a?this.paginatedClient.localQueryResultByToken(n):this.client.localQueryResultByToken(n)}catch(e){if(!(e instanceof Error))throw e;i?i(e,"Second argument to onUpdate onError is reserved for later use"):Promise.reject(e);continue}t(r,"Second argument to onUpdate callback is reserved for later use")}}}async mutation(e,t,r){if(this.disabled)throw Error("ConvexClient is disabled");return await this.client.mutation((0,a.getFunctionName)(e),t,r)}async action(e,t){if(this.disabled)throw Error("ConvexClient is disabled");return await this.client.action((0,a.getFunctionName)(e),t)}async query(e,t){if(this.disabled)throw Error("ConvexClient is disabled");let r=this.client.localQueryResult((0,a.getFunctionName)(e),t);return void 0!==r?Promise.resolve(r):new Promise((r,s)=>{let{unsubscribe:n}=this.onUpdate(e,t,e=>{n(),r(e)},e=>{n(),s(e)})})}connectionState(){if(this.disabled)throw Error("ConvexClient is disabled");return this.client.connectionState()}subscribeToConnectionState(e){return this.disabled?()=>{}:this.client.subscribeToConnectionState(e)}}},{"../common/index.js":"l8P8A","./index.js":"bKOGH","../server/api.js":"cQjid","./sync/paginated_query_client.js":"i98Jr","./sync/udf_path_utils.js":"bhVyA","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],i98Jr:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"PaginatedQueryClient",()=>c);var n=e("./udf_path_utils.js"),i=e("./pagination.js"),o=e("../../vendor/long.js"),a=Object.defineProperty,l=(e,t,r)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,u=(e,t,r)=>l(e,"symbol"!=typeof t?t+"":t,r);class c{constructor(e,t){this.client=e,this.onTransition=t,u(this,"paginatedQuerySet",new Map),u(this,"lastTransitionTs"),this.lastTransitionTs=(0,o.Long).fromNumber(0),this.client.addOnTransitionHandler(e=>this.onBaseTransition(e))}subscribe(e,t,r){let s=(0,n.canonicalizeUdfPath)(e),i=(0,n.serializePaginatedPathAndArgs)(s,t,r),o=this.paginatedQuerySet.get(i);return o?o.numSubscribers+=1:(this.paginatedQuerySet.set(i,{token:i,canonicalizedUdfPath:s,args:t,numSubscribers:1,options:{initialNumItems:r.initialNumItems},nextPageKey:0,pageKeys:[],pageKeyToQuery:new Map,ongoingSplits:new Map,skip:!1,id:r.id}),this.addPageToPaginatedQuery(i,null,r.initialNumItems)),{paginatedQueryToken:i,unsubscribe:()=>this.removePaginatedQuerySubscriber(i)}}localQueryResult(e,t,r){let s=(0,n.canonicalizeUdfPath)(e),i=(0,n.serializePaginatedPathAndArgs)(s,t,r);return this.localQueryResultByToken(i)}localQueryResultByToken(e){let t;let r=this.paginatedQuerySet.get(e);if(!r)return;let s=this.activePageQueryTokens(r);if(0===s.length)return{results:[],status:"LoadingFirstPage",loadMore:t=>this.loadMoreOfPaginatedQuery(e,t)};let n=[],o=!1,a=!1;for(let e of s){let t=this.client.localQueryResultByToken(e);if(void 0===t){o=!0,a=!1;continue}let r=(0,i.asPaginationResult)(t);n=n.concat(r.page),a=!!r.isDone}return t=o?0===n.length?"LoadingFirstPage":"LoadingMore":a?"Exhausted":"CanLoadMore",{results:n,status:t,loadMore:t=>this.loadMoreOfPaginatedQuery(e,t)}}onBaseTransition(e){let t=e.queries.map(e=>e.token),r=this.queriesContainingTokens(t),s=[];r.length>0&&(this.processPaginatedQuerySplits(r,e=>this.client.localQueryResultByToken(e)),s=r.map(e=>({token:e,modification:{kind:"Updated",result:this.localQueryResultByToken(e)}})));let n={...e,paginatedQueries:s};this.onTransition(n)}loadMoreOfPaginatedQuery(e,t){this.mustGetPaginatedQuery(e);let r=this.queryTokenForLastPageOfPaginatedQuery(e),s=this.client.localQueryResultByToken(r);if(!s)return!1;let n=(0,i.asPaginationResult)(s);if(n.isDone)return!1;this.addPageToPaginatedQuery(e,n.continueCursor,t);let o={timestamp:this.lastTransitionTs,reflectedMutations:[],queries:[],paginatedQueries:[{token:e,modification:{kind:"Updated",result:this.localQueryResultByToken(e)}}]};return this.onTransition(o),!0}queriesContainingTokens(e){if(0===e.length)return[];let t=[],r=new Set(e);for(let[e,s]of this.paginatedQuerySet)for(let n of this.allQueryTokens(s))if(r.has(n)){t.push(e);break}return t}processPaginatedQuerySplits(e,t){for(let r of e){let e=this.mustGetPaginatedQuery(r),{ongoingSplits:s,pageKeyToQuery:n,pageKeys:o}=e;for(let[r,[i,o]]of s){let s=void 0!==t(n.get(i).queryToken)&&void 0!==t(n.get(o).queryToken);s&&this.completePaginatedQuerySplit(e,r,i,o)}for(let r of o){if(s.has(r))continue;let o=n.get(r).queryToken,a=t(o);if(!a)continue;let l=(0,i.asPaginationResult)(a),u=l.splitCursor&&("SplitRecommended"===l.pageStatus||"SplitRequired"===l.pageStatus||l.page.length>2*e.options.initialNumItems);u&&this.splitPaginatedQueryPage(e,r,l.splitCursor,l.continueCursor)}}}splitPaginatedQueryPage(e,t,r,s){let n=e.nextPageKey++,i=e.nextPageKey++,o={cursor:s,numItems:e.options.initialNumItems,id:e.id},a=this.client.subscribe(e.canonicalizedUdfPath,{...e.args,paginationOpts:{...o,cursor:null,endCursor:r}});e.pageKeyToQuery.set(n,a);let l=this.client.subscribe(e.canonicalizedUdfPath,{...e.args,paginationOpts:{...o,cursor:r,endCursor:s}});e.pageKeyToQuery.set(i,l),e.ongoingSplits.set(t,[n,i])}addPageToPaginatedQuery(e,t,r){let s=this.mustGetPaginatedQuery(e),n=s.nextPageKey++,i={cursor:t,numItems:r,id:s.id},o={...s.args,paginationOpts:i},a=this.client.subscribe(s.canonicalizedUdfPath,o);return s.pageKeys.push(n),s.pageKeyToQuery.set(n,a),a}removePaginatedQuerySubscriber(e){let t=this.paginatedQuerySet.get(e);if(t&&(t.numSubscribers-=1,!(t.numSubscribers>0))){for(let e of t.pageKeyToQuery.values())e.unsubscribe();this.paginatedQuerySet.delete(e)}}completePaginatedQuerySplit(e,t,r,s){let n=e.pageKeyToQuery.get(t);e.pageKeyToQuery.delete(t);let i=e.pageKeys.indexOf(t);e.pageKeys.splice(i,1,r,s),e.ongoingSplits.delete(t),n.unsubscribe()}activePageQueryTokens(e){return e.pageKeys.map(t=>e.pageKeyToQuery.get(t).queryToken)}allQueryTokens(e){return Array.from(e.pageKeyToQuery.values()).map(e=>e.queryToken)}queryTokenForLastPageOfPaginatedQuery(e){let t=this.mustGetPaginatedQuery(e),r=t.pageKeys[t.pageKeys.length-1];if(void 0===r)throw Error(`No pages for paginated query ${e}`);return t.pageKeyToQuery.get(r).queryToken}mustGetPaginatedQuery(e){let t=this.paginatedQuerySet.get(e);if(!t)throw Error("paginated query no longer exists for token "+e);return t}}},{"./udf_path_utils.js":"bhVyA","./pagination.js":"94SKv","../../vendor/long.js":"heN3C","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],"94SKv":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");function n(e){if("number"!=typeof e.paginationOpts.numItems)throw Error(`Not valid paginated query args: ${JSON.stringify(e)}`);return e}function i(e){if("object"!=typeof e||null===e||!Array.isArray(e.page)||"boolean"!=typeof e.isDone||"string"!=typeof e.continueCursor)throw Error(`Not a valid paginated query result: ${e?.toString()}`);return e}s.defineInteropFlag(r),s.export(r,"asPaginationArgs",()=>n),s.export(r,"asPaginationResult",()=>i)},{"@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],wlBrJ:[function(e,t,r){let s;var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r),n.export(r,"STATUS_CODE_OK",()=>p),n.export(r,"STATUS_CODE_BAD_REQUEST",()=>f),n.export(r,"STATUS_CODE_UDF_FAILED",()=>g),n.export(r,"setFetch",()=>m),n.export(r,"ConvexHttpClient",()=>y);var i=e("../server/api.js"),o=e("../common/index.js"),a=e("../index.js"),l=e("../values/index.js"),u=e("./logging.js"),c=Object.defineProperty,h=(e,t,r)=>t in e?c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,d=(e,t,r)=>h(e,"symbol"!=typeof t?t+"":t,r);let p=200,f=400,g=560;function m(e){s=e}class y{constructor(e,t){if(d(this,"address"),d(this,"auth"),d(this,"adminAuth"),d(this,"encodedTsPromise"),d(this,"debug"),d(this,"fetchOptions"),d(this,"fetch"),d(this,"logger"),d(this,"mutationQueue",[]),d(this,"isProcessingQueue",!1),"boolean"==typeof t)throw Error("skipConvexDeploymentUrlCheck as the second argument is no longer supported. Please pass an options object, `{ skipConvexDeploymentUrlCheck: true }`.");!0!==(t??{}).skipConvexDeploymentUrlCheck&&(0,o.validateDeploymentUrl)(e),this.logger=t?.logger===!1?(0,u.instantiateNoopLogger)({verbose:!1}):t?.logger!==!0&&t?.logger?t.logger:(0,u.instantiateDefaultLogger)({verbose:!1}),this.address=e,this.debug=!0,this.auth=void 0,this.adminAuth=void 0,this.fetch=t?.fetch,t?.auth&&this.setAuth(t.auth)}backendUrl(){return`${this.address}/api`}get url(){return this.address}setAuth(e){this.clearAuth(),this.auth=e}setAdminAuth(e,t){if(this.clearAuth(),void 0!==t){let r=new TextEncoder().encode(JSON.stringify(t)),s=btoa(String.fromCodePoint(...r));this.adminAuth=`${e}:${s}`}else this.adminAuth=e}clearAuth(){this.auth=void 0,this.adminAuth=void 0}setDebug(e){this.debug=e}setFetchOptions(e){this.fetchOptions=e}async consistentQuery(e,...t){let r=(0,o.parseArgs)(t[0]),s=this.getTimestamp();return await this.queryInner(e,r,{timestampPromise:s})}async getTimestamp(){return this.encodedTsPromise?this.encodedTsPromise:this.encodedTsPromise=this.getTimestampInner()}async getTimestampInner(){let e=this.fetch||s||fetch,t={"Content-Type":"application/json","Convex-Client":`npm-${a.version}`},r=await e(`${this.address}/api/query_ts`,{...this.fetchOptions,method:"POST",headers:t});if(!r.ok)throw Error(await r.text());let{ts:n}=await r.json();return n}async query(e,...t){let r=(0,o.parseArgs)(t[0]);return await this.queryInner(e,r,{})}async queryInner(e,t,r){let n=(0,i.getFunctionName)(e),o=[(0,l.convexToJson)(t)],c={"Content-Type":"application/json","Convex-Client":`npm-${a.version}`};this.adminAuth?c.Authorization=`Convex ${this.adminAuth}`:this.auth&&(c.Authorization=`Bearer ${this.auth}`);let h=this.fetch||s||fetch,d=r.timestampPromise?await r.timestampPromise:void 0,p=JSON.stringify({path:n,format:"convex_encoded_json",args:o,...d?{ts:d}:{}}),f=d?`${this.address}/api/query_at_ts`:`${this.address}/api/query`,m=await h(f,{...this.fetchOptions,body:p,method:"POST",headers:c});if(!m.ok&&m.status!==g)throw Error(await m.text());let y=await m.json();if(this.debug)for(let e of y.logLines??[])(0,u.logForFunction)(this.logger,"info","query",n,e);switch(y.status){case"success":return(0,l.jsonToConvex)(y.value);case"error":if(void 0!==y.errorData)throw v(y.errorData,new l.ConvexError(y.errorMessage));throw Error(y.errorMessage);default:throw Error(`Invalid response: ${JSON.stringify(y)}`)}}async mutationInner(e,t){let r=(0,i.getFunctionName)(e),n=JSON.stringify({path:r,format:"convex_encoded_json",args:[(0,l.convexToJson)(t)]}),o={"Content-Type":"application/json","Convex-Client":`npm-${a.version}`};this.adminAuth?o.Authorization=`Convex ${this.adminAuth}`:this.auth&&(o.Authorization=`Bearer ${this.auth}`);let c=this.fetch||s||fetch,h=await c(`${this.address}/api/mutation`,{...this.fetchOptions,body:n,method:"POST",headers:o});if(!h.ok&&h.status!==g)throw Error(await h.text());let d=await h.json();if(this.debug)for(let e of d.logLines??[])(0,u.logForFunction)(this.logger,"info","mutation",r,e);switch(d.status){case"success":return(0,l.jsonToConvex)(d.value);case"error":if(void 0!==d.errorData)throw v(d.errorData,new l.ConvexError(d.errorMessage));throw Error(d.errorMessage);default:throw Error(`Invalid response: ${JSON.stringify(d)}`)}}async processMutationQueue(){if(!this.isProcessingQueue){for(this.isProcessingQueue=!0;this.mutationQueue.length>0;){let{mutation:e,args:t,resolve:r,reject:s}=this.mutationQueue.shift();try{let s=await this.mutationInner(e,t);r(s)}catch(e){s(e)}}this.isProcessingQueue=!1}}enqueueMutation(e,t){return new Promise((r,s)=>{this.mutationQueue.push({mutation:e,args:t,resolve:r,reject:s}),this.processMutationQueue()})}async mutation(e,...t){let[r,s]=t,n=(0,o.parseArgs)(r),i=!s?.skipQueue;return i?await this.enqueueMutation(e,n):await this.mutationInner(e,n)}async action(e,...t){let r=(0,o.parseArgs)(t[0]),n=(0,i.getFunctionName)(e),c=JSON.stringify({path:n,format:"convex_encoded_json",args:[(0,l.convexToJson)(r)]}),h={"Content-Type":"application/json","Convex-Client":`npm-${a.version}`};this.adminAuth?h.Authorization=`Convex ${this.adminAuth}`:this.auth&&(h.Authorization=`Bearer ${this.auth}`);let d=this.fetch||s||fetch,p=await d(`${this.address}/api/action`,{...this.fetchOptions,body:c,method:"POST",headers:h});if(!p.ok&&p.status!==g)throw Error(await p.text());let f=await p.json();if(this.debug)for(let e of f.logLines??[])(0,u.logForFunction)(this.logger,"info","action",n,e);switch(f.status){case"success":return(0,l.jsonToConvex)(f.value);case"error":if(void 0!==f.errorData)throw v(f.errorData,new l.ConvexError(f.errorMessage));throw Error(f.errorMessage);default:throw Error(`Invalid response: ${JSON.stringify(f)}`)}}async function(e,t,...r){let n=(0,o.parseArgs)(r[0]),c="string"==typeof e?e:(0,i.getFunctionName)(e),h=JSON.stringify({componentPath:t,path:c,format:"convex_encoded_json",args:(0,l.convexToJson)(n)}),d={"Content-Type":"application/json","Convex-Client":`npm-${a.version}`};this.adminAuth?d.Authorization=`Convex ${this.adminAuth}`:this.auth&&(d.Authorization=`Bearer ${this.auth}`);let p=this.fetch||s||fetch,f=await p(`${this.address}/api/function`,{...this.fetchOptions,body:h,method:"POST",headers:d});if(!f.ok&&f.status!==g)throw Error(await f.text());let m=await f.json();if(this.debug)for(let e of m.logLines??[])(0,u.logForFunction)(this.logger,"info","any",c,e);switch(m.status){case"success":return(0,l.jsonToConvex)(m.value);case"error":if(void 0!==m.errorData)throw v(m.errorData,new l.ConvexError(m.errorMessage));throw Error(m.errorMessage);default:throw Error(`Invalid response: ${JSON.stringify(m)}`)}}}function v(e,t){return t.data=(0,l.jsonToConvex)(e),t}},{"../server/api.js":"cQjid","../common/index.js":"l8P8A","../index.js":"dF102","../values/index.js":"dViyc","./logging.js":"5I2B4","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],ekwfn:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"api",()=>i),s.export(r,"internal",()=>o),s.export(r,"components",()=>a);var n=e("convex/server");let i=n.anyApi,o=n.anyApi,a=(0,n.componentsGeneric)()},{"convex/server":"gWdh5","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],gWdh5:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"actionGeneric",()=>i.actionGeneric),s.export(r,"httpActionGeneric",()=>i.httpActionGeneric),s.export(r,"mutationGeneric",()=>i.mutationGeneric),s.export(r,"queryGeneric",()=>i.queryGeneric),s.export(r,"internalActionGeneric",()=>i.internalActionGeneric),s.export(r,"internalMutationGeneric",()=>i.internalMutationGeneric),s.export(r,"internalQueryGeneric",()=>i.internalQueryGeneric),s.export(r,"cronJobs",()=>u.cronJobs),s.export(r,"httpRouter",()=>c.httpRouter),s.export(r,"HttpRouter",()=>c.HttpRouter),s.export(r,"ROUTABLE_HTTP_METHODS",()=>c.ROUTABLE_HTTP_METHODS),s.export(r,"anyApi",()=>h.anyApi),s.export(r,"getFunctionName",()=>h.getFunctionName),s.export(r,"makeFunctionReference",()=>h.makeFunctionReference),s.export(r,"filterApi",()=>h.filterApi),s.export(r,"defineApp",()=>d.defineApp),s.export(r,"defineComponent",()=>d.defineComponent),s.export(r,"componentsGeneric",()=>d.componentsGeneric),s.export(r,"createFunctionHandle",()=>d.createFunctionHandle),s.export(r,"currentSystemUdfInComponent",()=>d.currentSystemUdfInComponent),s.export(r,"getFunctionAddress",()=>d.getFunctionAddress),s.export(r,"defineTable",()=>p.defineTable),s.export(r,"defineSchema",()=>p.defineSchema);var n=e("./database.js");s.exportAll(n,r);var i=e("./impl/registration_impl.js"),o=e("./pagination.js");s.exportAll(o,r);var a=e("./search_filter_builder.js");s.exportAll(a,r);var l=e("./storage.js");s.exportAll(l,r);var u=e("./cron.js"),c=e("./router.js"),h=e("./api.js"),d=e("./components/index.js"),p=e("./schema.js")},{"./database.js":"gTFuU","./impl/registration_impl.js":"iBBn6","./pagination.js":"iF7Id","./search_filter_builder.js":"c1vfD","./storage.js":"8w2vI","./cron.js":"9tfnN","./router.js":"2xUUi","./api.js":"cQjid","./components/index.js":"jGOvp","./schema.js":"2T9ge","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],gTFuU:[function(e,t,r){},{}],iBBn6:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"validateReturnValue",()=>y),s.export(r,"invokeFunction",()=>v),s.export(r,"mutationGeneric",()=>k),s.export(r,"internalMutationGeneric",()=>A),s.export(r,"queryGeneric",()=>T),s.export(r,"internalQueryGeneric",()=>I),s.export(r,"actionGeneric",()=>O),s.export(r,"internalActionGeneric",()=>E),s.export(r,"httpActionGeneric",()=>_);var n=e("../../values/index.js"),i=e("./actions_impl.js"),o=e("./vector_search_impl.js"),a=e("./authentication_impl.js"),l=e("./database_impl.js"),u=e("./query_impl.js"),c=e("./scheduler_impl.js"),h=e("./storage_impl.js"),d=e("../../common/index.js"),p=e("./syscall.js"),f=e("../../values/validator.js"),g=e("../components/paths.js");async function m(e,t){let r=(0,n.jsonToConvex)(JSON.parse(t)),s={db:(0,l.setupWriter)(),auth:(0,a.setupAuth)(""),storage:(0,h.setupStorageWriter)(""),scheduler:(0,c.setupMutationScheduler)(),runQuery:(e,t)=>P("query",e,t),runMutation:(e,t)=>P("mutation",e,t)},i=await v(e,s,r);return y(i),JSON.stringify((0,n.convexToJson)(void 0===i?null:i))}function y(e){if(e instanceof u.QueryInitializerImpl||e instanceof u.QueryImpl)throw Error("Return value is a Query. Results must be retrieved with `.collect()`, `.take(n), `.unique()`, or `.first()`.")}async function v(e,t,r){let s;try{s=await Promise.resolve(e(t,...r))}catch(e){throw"object"==typeof e&&null!==e&&Symbol.for("ConvexError") in e&&(e.data=JSON.stringify((0,n.convexToJson)(void 0===e.data?null:e.data)),e.ConvexErrorSymbol=Symbol.for("ConvexError")),e}return s}function b(e,t){return(r,s)=>(globalThis.console.warn(`Convex functions should not directly call other Convex functions. Consider calling a helper function instead. e.g. \`export const foo = ${e}(...); await foo(ctx);\` is not supported. See https://docs.convex.dev/production/best-practices/#use-helper-functions-to-write-shared-code`),t(r,s))}function w(){if("undefined"==typeof window||window.__convexAllowFunctionsInBrowser)return;let e=Object.getOwnPropertyDescriptor(globalThis,"window")?.get?.toString().includes("[native code]")??!1;e&&console.error("Convex functions should not be imported in the browser. This will throw an error in future versions of `convex`. If this is a false negative, please report it to Convex support.")}function x(e,t){if(void 0===t)throw Error(`A validator is undefined for field "${e}". This is often caused by circular imports. See https://docs.convex.dev/error#undefined-validator for details.`);return t}function j(e){return()=>{let t=(0,n.v).any();return"object"==typeof e&&void 0!==e.args&&(t=(0,f.asObjectValidator)(e.args)),JSON.stringify(t.json,x)}}function S(e){return()=>{let t;return"object"==typeof e&&void 0!==e.returns&&(t=(0,f.asObjectValidator)(e.returns)),JSON.stringify(t?t.json:null,x)}}let k=e=>{let t="function"==typeof e?e:e.handler,r=b("mutation",t);return w(),r.isMutation=!0,r.isPublic=!0,r.invokeMutation=e=>m(t,e),r.exportArgs=j(e),r.exportReturns=S(e),r._handler=t,r},A=e=>{let t="function"==typeof e?e:e.handler,r=b("internalMutation",t);return w(),r.isMutation=!0,r.isInternal=!0,r.invokeMutation=e=>m(t,e),r.exportArgs=j(e),r.exportReturns=S(e),r._handler=t,r};async function C(e,t){let r=(0,n.jsonToConvex)(JSON.parse(t)),s={db:(0,l.setupReader)(),auth:(0,a.setupAuth)(""),storage:(0,h.setupStorageReader)(""),runQuery:(e,t)=>P("query",e,t)},i=await v(e,s,r);return y(i),JSON.stringify((0,n.convexToJson)(void 0===i?null:i))}let T=e=>{let t="function"==typeof e?e:e.handler,r=b("query",t);return w(),r.isQuery=!0,r.isPublic=!0,r.invokeQuery=e=>C(t,e),r.exportArgs=j(e),r.exportReturns=S(e),r._handler=t,r},I=e=>{let t="function"==typeof e?e:e.handler,r=b("internalQuery",t);return w(),r.isQuery=!0,r.isInternal=!0,r.invokeQuery=e=>C(t,e),r.exportArgs=j(e),r.exportReturns=S(e),r._handler=t,r};async function R(e,t,r){let s=(0,n.jsonToConvex)(JSON.parse(r)),l=(0,i.setupActionCalls)(t),u={...l,auth:(0,a.setupAuth)(t),scheduler:(0,c.setupActionScheduler)(t),storage:(0,h.setupStorageActionWriter)(t),vectorSearch:(0,o.setupActionVectorSearch)(t)},d=await v(e,u,s);return JSON.stringify((0,n.convexToJson)(void 0===d?null:d))}let O=e=>{let t="function"==typeof e?e:e.handler,r=b("action",t);return w(),r.isAction=!0,r.isPublic=!0,r.invokeAction=(e,r)=>R(t,e,r),r.exportArgs=j(e),r.exportReturns=S(e),r._handler=t,r},E=e=>{let t="function"==typeof e?e:e.handler,r=b("internalAction",t);return w(),r.isAction=!0,r.isInternal=!0,r.invokeAction=(e,r)=>R(t,e,r),r.exportArgs=j(e),r.exportReturns=S(e),r._handler=t,r};async function q(e,t){let r=(0,i.setupActionCalls)(""),s={...r,auth:(0,a.setupAuth)(""),storage:(0,h.setupStorageActionWriter)(""),scheduler:(0,c.setupActionScheduler)(""),vectorSearch:(0,o.setupActionVectorSearch)("")};return await v(e,s,[t])}let _=e=>{let t=b("httpAction",e);return w(),t.isHttp=!0,t.invokeHttpAction=t=>q(e,t),t._handler=e,t};async function P(e,t,r){let s=(0,d.parseArgs)(r),i={udfType:e,args:(0,n.convexToJson)(s),...(0,g.getFunctionAddress)(t)},o=await (0,p.performAsyncSyscall)("1.0/runUdf",i);return(0,n.jsonToConvex)(o)}},{"../../values/index.js":"dViyc","./actions_impl.js":"g8hX8","./vector_search_impl.js":"6okIX","./authentication_impl.js":"6SwdS","./database_impl.js":"6IIeB","./query_impl.js":"hHSGt","./scheduler_impl.js":"isIAf","./storage_impl.js":"5f89n","../../common/index.js":"l8P8A","./syscall.js":"jJbDX","../../values/validator.js":"b5eX5","../components/paths.js":"5wHBq","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],g8hX8:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"setupActionCalls",()=>c);var n=e("../../values/index.js"),i=e("../../index.js"),o=e("./syscall.js"),a=e("../../common/index.js"),l=e("../components/paths.js");function u(e,t,r){let s=(0,l.getFunctionAddress)(t);return{...s,args:(0,n.convexToJson)((0,a.parseArgs)(r)),version:i.version,requestId:e}}function c(e){return{runQuery:async(t,r)=>{let s=await (0,o.performAsyncSyscall)("1.0/actions/query",u(e,t,r));return(0,n.jsonToConvex)(s)},runMutation:async(t,r)=>{let s=await (0,o.performAsyncSyscall)("1.0/actions/mutation",u(e,t,r));return(0,n.jsonToConvex)(s)},runAction:async(t,r)=>{let s=await (0,o.performAsyncSyscall)("1.0/actions/action",u(e,t,r));return(0,n.jsonToConvex)(s)}}}},{"../../values/index.js":"dViyc","../../index.js":"dF102","./syscall.js":"jJbDX","../../common/index.js":"l8P8A","../components/paths.js":"5wHBq","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],jJbDX:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"performSyscall",()=>o),s.export(r,"performAsyncSyscall",()=>a),s.export(r,"performJsSyscall",()=>l);var n=e("../../values/errors.js"),i=e("../../values/value.js");function o(e,t){if("undefined"==typeof Convex||void 0===Convex.syscall)throw Error("The Convex database and auth objects are being used outside of a Convex backend. Did you mean to use `useQuery` or `useMutation` to call a Convex function?");let r=Convex.syscall(e,JSON.stringify(t));return JSON.parse(r)}async function a(e,t){let r;if("undefined"==typeof Convex||void 0===Convex.asyncSyscall)throw Error("The Convex database and auth objects are being used outside of a Convex backend. Did you mean to use `useQuery` or `useMutation` to call a Convex function?");try{r=await Convex.asyncSyscall(e,JSON.stringify(t))}catch(e){if(void 0!==e.data){let t=new n.ConvexError(e.message);throw t.data=(0,i.jsonToConvex)(e.data),t}throw Error(e.message)}return JSON.parse(r)}function l(e,t){if("undefined"==typeof Convex||void 0===Convex.jsSyscall)throw Error("The Convex database and auth objects are being used outside of a Convex backend. Did you mean to use `useQuery` or `useMutation` to call a Convex function?");return Convex.jsSyscall(e,t)}},{"../../values/errors.js":"dS3IT","../../values/value.js":"3mC5W","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],"6okIX":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"setupActionVectorSearch",()=>d),s.export(r,"VectorQueryImpl",()=>p),s.export(r,"ExpressionImpl",()=>f),s.export(r,"serializeExpression",()=>g),s.export(r,"filterBuilderImpl",()=>m);var n=e("./syscall.js"),i=e("../../index.js"),o=e("../vector_search.js"),a=e("./validate.js"),l=e("../../values/value.js"),u=Object.defineProperty,c=(e,t,r)=>t in e?u(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,h=(e,t,r)=>c(e,"symbol"!=typeof t?t+"":t,r);function d(e){return async(t,r,s)=>{if((0,a.validateArg)(t,1,"vectorSearch","tableName"),(0,a.validateArg)(r,2,"vectorSearch","indexName"),(0,a.validateArg)(s,3,"vectorSearch","query"),!s.vector||!Array.isArray(s.vector)||0===s.vector.length)throw Error("`vector` must be a non-empty Array in vectorSearch");return await new p(e,t+"."+r,s).collect()}}class p{constructor(e,t,r){h(this,"requestId"),h(this,"state"),this.requestId=e;let s=r.filter?g(r.filter(m)):null;this.state={type:"preparing",query:{indexName:t,limit:r.limit,vector:r.vector,expressions:s}}}async collect(){if("consumed"===this.state.type)throw Error("This query is closed and can't emit any more values.");let e=this.state.query;this.state={type:"consumed"};let{results:t}=await (0,n.performAsyncSyscall)("1.0/actions/vectorSearch",{requestId:this.requestId,version:i.version,query:e});return t}}class f extends o.FilterExpression{constructor(e){super(),h(this,"inner"),this.inner=e}serialize(){return this.inner}}function g(e){return e instanceof f?e.serialize():{$literal:(0,l.convexOrUndefinedToJson)(e)}}let m={eq(e,t){if("string"!=typeof e)throw Error("The first argument to `q.eq` must be a field name.");return new f({$eq:[g(new f({$field:e})),g(t)]})},or:(...e)=>new f({$or:e.map(g)})}},{"./syscall.js":"jJbDX","../../index.js":"dF102","../vector_search.js":"2X5UL","./validate.js":"9fisJ","../../values/value.js":"3mC5W","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],"2X5UL":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"FilterExpression",()=>a);var n=Object.defineProperty,i=(e,t,r)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,o=(e,t,r)=>i(e,"symbol"!=typeof t?t+"":t,r);class a{constructor(){o(this,"_isExpression"),o(this,"_value")}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],"9fisJ":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");function n(e,t,r,s){if(void 0===e)throw TypeError(`Must provide arg ${t} \`${s}\` to \`${r}\``)}function i(e,t,r,s){if(!Number.isInteger(e))throw TypeError(`Arg ${t} \`${s}\` to \`${r}\` must be an integer`)}function o(e,t,r,s){if(!Number.isInteger(e)||e<0)throw TypeError(`Arg ${t} \`${s}\` to \`${r}\` must be a non-negative integer`)}s.defineInteropFlag(r),s.export(r,"validateArg",()=>n),s.export(r,"validateArgIsInteger",()=>i),s.export(r,"validateArgIsNonNegativeInteger",()=>o)},{"@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],"6SwdS":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"setupAuth",()=>i);var n=e("./syscall.js");function i(e){return{getUserIdentity:async()=>await (0,n.performAsyncSyscall)("1.0/getUserIdentity",{requestId:e})}}},{"./syscall.js":"jJbDX","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],"6IIeB":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"setupReader",()=>h),s.export(r,"setupWriter",()=>m);var n=e("../../values/index.js"),i=e("./syscall.js"),o=e("./query_impl.js"),a=e("./validate.js"),l=e("../../index.js"),u=e("../../values/value.js");async function c(e,t,r){if((0,a.validateArg)(t,1,"get","id"),"string"!=typeof t)throw Error(`Invalid argument \`id\` for \`db.get\`, expected string but got '${typeof t}': ${t}`);let s={id:(0,n.convexToJson)(t),isSystem:r,version:l.version,table:e},o=await (0,i.performAsyncSyscall)("1.0/get",s);return(0,n.jsonToConvex)(o)}function h(){let e=(e=!1)=>({get:async(t,r)=>void 0!==r?await c(t,r,e):await c(void 0,t,e),query:t=>new y(t,e).query(),normalizeId:(t,r)=>{(0,a.validateArg)(t,1,"normalizeId","tableName"),(0,a.validateArg)(r,2,"normalizeId","id");let s=t.startsWith("_");if(s!==e)throw Error(`${s?"System":"User"} tables can only be accessed from db.${e?"":"system."}normalizeId().`);let o=(0,i.performSyscall)("1.0/db/normalizeId",{table:t,idString:r}),l=(0,n.jsonToConvex)(o);return l.id},system:null,table:t=>new y(t,e)}),{system:t,...r}=e(!0),s=e();return s.system=r,s}async function d(e,t){if(e.startsWith("_"))throw Error("System tables (prefixed with `_`) are read-only.");(0,a.validateArg)(e,1,"insert","table"),(0,a.validateArg)(t,2,"insert","value");let r=await (0,i.performAsyncSyscall)("1.0/insert",{table:e,value:(0,n.convexToJson)(t)}),s=(0,n.jsonToConvex)(r);return s._id}async function p(e,t,r){(0,a.validateArg)(t,1,"patch","id"),(0,a.validateArg)(r,2,"patch","value"),await (0,i.performAsyncSyscall)("1.0/shallowMerge",{id:(0,n.convexToJson)(t),value:(0,u.patchValueToJson)(r),table:e})}async function f(e,t,r){(0,a.validateArg)(t,1,"replace","id"),(0,a.validateArg)(r,2,"replace","value"),await (0,i.performAsyncSyscall)("1.0/replace",{id:(0,n.convexToJson)(t),value:(0,n.convexToJson)(r),table:e})}async function g(e,t){(0,a.validateArg)(t,1,"delete","id"),await (0,i.performAsyncSyscall)("1.0/remove",{id:(0,n.convexToJson)(t),table:e})}function m(){let e=h();return{get:e.get,query:e.query,normalizeId:e.normalizeId,system:e.system,insert:async(e,t)=>await d(e,t),patch:async(e,t,r)=>void 0!==r?await p(e,t,r):await p(void 0,e,t),replace:async(e,t,r)=>void 0!==r?await f(e,t,r):await f(void 0,e,t),delete:async(e,t)=>void 0!==t?await g(e,t):await g(void 0,e),table:e=>new v(e,!1)}}class y{constructor(e,t){this.tableName=e,this.isSystem=t}async get(e){return c(this.tableName,e,this.isSystem)}query(){let e=this.tableName.startsWith("_");if(e!==this.isSystem)throw Error(`${e?"System":"User"} tables can only be accessed from db.${this.isSystem?"":"system."}query().`);return new o.QueryInitializerImpl(this.tableName)}}class v extends y{async insert(e){return d(this.tableName,e)}async patch(e,t){return p(this.tableName,e,t)}async replace(e,t){return f(this.tableName,e,t)}async delete(e){return g(this.tableName,e)}}},{"../../values/index.js":"dViyc","./syscall.js":"jJbDX","./query_impl.js":"hHSGt","./validate.js":"9fisJ","../../index.js":"dF102","../../values/value.js":"3mC5W","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],hHSGt:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"QueryInitializerImpl",()=>f),s.export(r,"QueryImpl",()=>m);var n=e("../../values/index.js"),i=e("./syscall.js"),o=e("./filter_builder_impl.js"),a=e("./index_range_builder_impl.js"),l=e("./search_filter_builder_impl.js"),u=e("./validate.js"),c=e("../../index.js"),h=Object.defineProperty,d=(e,t,r)=>t in e?h(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,p=(e,t,r)=>d(e,"symbol"!=typeof t?t+"":t,r);class f{constructor(e){p(this,"tableName"),this.tableName=e}withIndex(e,t){(0,u.validateArg)(e,1,"withIndex","indexName");let r=(0,a.IndexRangeBuilderImpl).new();return void 0!==t&&(r=t(r)),new m({source:{type:"IndexRange",indexName:this.tableName+"."+e,range:r.export(),order:null},operators:[]})}withSearchIndex(e,t){(0,u.validateArg)(e,1,"withSearchIndex","indexName"),(0,u.validateArg)(t,2,"withSearchIndex","searchFilter");let r=(0,l.SearchFilterBuilderImpl).new();return new m({source:{type:"Search",indexName:this.tableName+"."+e,filters:t(r).export()},operators:[]})}fullTableScan(){return new m({source:{type:"FullTableScan",tableName:this.tableName,order:null},operators:[]})}order(e){return this.fullTableScan().order(e)}async count(){let e=await (0,i.performAsyncSyscall)("1.0/count",{table:this.tableName}),t=(0,n.jsonToConvex)(e);return t}filter(e){return this.fullTableScan().filter(e)}limit(e){return this.fullTableScan().limit(e)}collect(){return this.fullTableScan().collect()}take(e){return this.fullTableScan().take(e)}paginate(e){return this.fullTableScan().paginate(e)}first(){return this.fullTableScan().first()}unique(){return this.fullTableScan().unique()}[Symbol.asyncIterator](){return this.fullTableScan()[Symbol.asyncIterator]()}}function g(e){throw Error("consumed"===e?"This query is closed and can't emit any more values.":"This query has been chained with another operator and can't be reused.")}class m{constructor(e){p(this,"state"),p(this,"tableNameForErrorMessages"),this.state={type:"preparing",query:e},"FullTableScan"===e.source.type?this.tableNameForErrorMessages=e.source.tableName:this.tableNameForErrorMessages=e.source.indexName.split(".")[0]}takeQuery(){if("preparing"!==this.state.type)throw Error("A query can only be chained once and can't be chained after iteration begins.");let e=this.state.query;return this.state={type:"closed"},e}startQuery(){if("executing"===this.state.type)throw Error("Iteration can only begin on a query once.");("closed"===this.state.type||"consumed"===this.state.type)&&g(this.state.type);let e=this.state.query,{queryId:t}=(0,i.performSyscall)("1.0/queryStream",{query:e,version:c.version});return this.state={type:"executing",queryId:t},t}closeQuery(){if("executing"===this.state.type){let e=this.state.queryId;(0,i.performSyscall)("1.0/queryCleanup",{queryId:e})}this.state={type:"consumed"}}order(e){(0,u.validateArg)(e,1,"order","order");let t=this.takeQuery();if("Search"===t.source.type)throw Error("Search queries must always be in relevance order. Can not set order manually.");if(null!==t.source.order)throw Error("Queries may only specify order at most once");return t.source.order=e,new m(t)}filter(e){(0,u.validateArg)(e,1,"filter","predicate");let t=this.takeQuery();if(t.operators.length>=256)throw Error("Can't construct query with more than 256 operators");return t.operators.push({filter:(0,o.serializeExpression)(e(o.filterBuilderImpl))}),new m(t)}limit(e){(0,u.validateArg)(e,1,"limit","n");let t=this.takeQuery();return t.operators.push({limit:e}),new m(t)}[Symbol.asyncIterator](){return this.startQuery(),this}async next(){("closed"===this.state.type||"consumed"===this.state.type)&&g(this.state.type);let e="preparing"===this.state.type?this.startQuery():this.state.queryId,{value:t,done:r}=await (0,i.performAsyncSyscall)("1.0/queryStreamNext",{queryId:e});r&&this.closeQuery();let s=(0,n.jsonToConvex)(t);return{value:s,done:r}}return(){return this.closeQuery(),Promise.resolve({done:!0,value:void 0})}async paginate(e){if((0,u.validateArg)(e,1,"paginate","options"),"number"!=typeof e?.numItems||e.numItems<0)throw Error(`\`options.numItems\` must be a positive number. Received \`${e?.numItems}\`.`);let t=this.takeQuery(),r=e.numItems,s=e.cursor,o=e?.endCursor??null,a=e.maximumRowsRead??null,{page:l,isDone:h,continueCursor:d,splitCursor:p,pageStatus:f}=await (0,i.performAsyncSyscall)("1.0/queryPage",{query:t,cursor:s,endCursor:o,pageSize:r,maximumRowsRead:a,maximumBytesRead:e.maximumBytesRead,version:c.version});return{page:l.map(e=>(0,n.jsonToConvex)(e)),isDone:h,continueCursor:d,splitCursor:p,pageStatus:f}}async collect(){let e=[];for await(let t of this)e.push(t);return e}async take(e){return(0,u.validateArg)(e,1,"take","n"),(0,u.validateArgIsNonNegativeInteger)(e,1,"take","n"),this.limit(e).collect()}async first(){let e=await this.take(1);return 0===e.length?null:e[0]}async unique(){let e=await this.take(2);if(0===e.length)return null;if(2===e.length)throw Error(`unique() query returned more than one result from table ${this.tableNameForErrorMessages}:
 [${e[0]._id}, ${e[1]._id}, ...]`);return e[0]}}},{"../../values/index.js":"dViyc","./syscall.js":"jJbDX","./filter_builder_impl.js":"2kmaB","./index_range_builder_impl.js":"h23rm","./search_filter_builder_impl.js":"5w2OX","./validate.js":"9fisJ","../../index.js":"dF102","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],"2kmaB":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"ExpressionImpl",()=>u),s.export(r,"serializeExpression",()=>c),s.export(r,"filterBuilderImpl",()=>h);var n=e("../../values/value.js"),i=e("../filter_builder.js"),o=Object.defineProperty,a=(e,t,r)=>t in e?o(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,l=(e,t,r)=>a(e,"symbol"!=typeof t?t+"":t,r);class u extends i.Expression{constructor(e){super(),l(this,"inner"),this.inner=e}serialize(){return this.inner}}function c(e){return e instanceof u?e.serialize():{$literal:(0,n.convexOrUndefinedToJson)(e)}}let h={eq:(e,t)=>new u({$eq:[c(e),c(t)]}),neq:(e,t)=>new u({$neq:[c(e),c(t)]}),lt:(e,t)=>new u({$lt:[c(e),c(t)]}),lte:(e,t)=>new u({$lte:[c(e),c(t)]}),gt:(e,t)=>new u({$gt:[c(e),c(t)]}),gte:(e,t)=>new u({$gte:[c(e),c(t)]}),add:(e,t)=>new u({$add:[c(e),c(t)]}),sub:(e,t)=>new u({$sub:[c(e),c(t)]}),mul:(e,t)=>new u({$mul:[c(e),c(t)]}),div:(e,t)=>new u({$div:[c(e),c(t)]}),mod:(e,t)=>new u({$mod:[c(e),c(t)]}),neg:e=>new u({$neg:c(e)}),and:(...e)=>new u({$and:e.map(c)}),or:(...e)=>new u({$or:e.map(c)}),not:e=>new u({$not:c(e)}),field:e=>new u({$field:e})}},{"../../values/value.js":"3mC5W","../filter_builder.js":"aVW8d","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],aVW8d:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"Expression",()=>a);var n=Object.defineProperty,i=(e,t,r)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,o=(e,t,r)=>i(e,"symbol"!=typeof t?t+"":t,r);class a{constructor(){o(this,"_isExpression"),o(this,"_value")}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],h23rm:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"IndexRangeBuilderImpl",()=>u);var n=e("../../values/value.js"),i=e("../index_range_builder.js"),o=Object.defineProperty,a=(e,t,r)=>t in e?o(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,l=(e,t,r)=>a(e,"symbol"!=typeof t?t+"":t,r);class u extends i.IndexRange{constructor(e){super(),l(this,"rangeExpressions"),l(this,"isConsumed"),this.rangeExpressions=e,this.isConsumed=!1}static new(){return new u([])}consume(){if(this.isConsumed)throw Error("IndexRangeBuilder has already been used! Chain your method calls like `q => q.eq(...).eq(...)`. See https://docs.convex.dev/using/indexes");this.isConsumed=!0}eq(e,t){return this.consume(),new u(this.rangeExpressions.concat({type:"Eq",fieldPath:e,value:(0,n.convexOrUndefinedToJson)(t)}))}gt(e,t){return this.consume(),new u(this.rangeExpressions.concat({type:"Gt",fieldPath:e,value:(0,n.convexOrUndefinedToJson)(t)}))}gte(e,t){return this.consume(),new u(this.rangeExpressions.concat({type:"Gte",fieldPath:e,value:(0,n.convexOrUndefinedToJson)(t)}))}lt(e,t){return this.consume(),new u(this.rangeExpressions.concat({type:"Lt",fieldPath:e,value:(0,n.convexOrUndefinedToJson)(t)}))}lte(e,t){return this.consume(),new u(this.rangeExpressions.concat({type:"Lte",fieldPath:e,value:(0,n.convexOrUndefinedToJson)(t)}))}export(){return this.consume(),this.rangeExpressions}}},{"../../values/value.js":"3mC5W","../index_range_builder.js":"9O16L","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],"9O16L":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"IndexRange",()=>a);var n=Object.defineProperty,i=(e,t,r)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,o=(e,t,r)=>i(e,"symbol"!=typeof t?t+"":t,r);class a{constructor(){o(this,"_isIndexRange")}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],"5w2OX":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"SearchFilterBuilderImpl",()=>c);var n=e("../../values/value.js"),i=e("../search_filter_builder.js"),o=e("./validate.js"),a=Object.defineProperty,l=(e,t,r)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,u=(e,t,r)=>l(e,"symbol"!=typeof t?t+"":t,r);class c extends i.SearchFilter{constructor(e){super(),u(this,"filters"),u(this,"isConsumed"),this.filters=e,this.isConsumed=!1}static new(){return new c([])}consume(){if(this.isConsumed)throw Error("SearchFilterBuilder has already been used! Chain your method calls like `q => q.search(...).eq(...)`.");this.isConsumed=!0}search(e,t){return(0,o.validateArg)(e,1,"search","fieldName"),(0,o.validateArg)(t,2,"search","query"),this.consume(),new c(this.filters.concat({type:"Search",fieldPath:e,value:t}))}eq(e,t){return(0,o.validateArg)(e,1,"eq","fieldName"),2!=arguments.length&&(0,o.validateArg)(t,2,"search","value"),this.consume(),new c(this.filters.concat({type:"Eq",fieldPath:e,value:(0,n.convexOrUndefinedToJson)(t)}))}export(){return this.consume(),this.filters}}},{"../../values/value.js":"3mC5W","../search_filter_builder.js":"c1vfD","./validate.js":"9fisJ","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],c1vfD:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"SearchFilter",()=>a);var n=Object.defineProperty,i=(e,t,r)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,o=(e,t,r)=>i(e,"symbol"!=typeof t?t+"":t,r);class a{constructor(){o(this,"_isSearchFilter")}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],isIAf:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"setupMutationScheduler",()=>c),s.export(r,"setupActionScheduler",()=>h);var n=e("../../values/index.js"),i=e("../../index.js"),o=e("./syscall.js"),a=e("../../common/index.js"),l=e("./validate.js"),u=e("../components/paths.js");function c(){return{runAfter:async(e,t,r)=>{let s=d(e,t,r);return await (0,o.performAsyncSyscall)("1.0/schedule",s)},runAt:async(e,t,r)=>{let s=p(e,t,r);return await (0,o.performAsyncSyscall)("1.0/schedule",s)},cancel:async e=>{(0,l.validateArg)(e,1,"cancel","id");let t={id:(0,n.convexToJson)(e)};await (0,o.performAsyncSyscall)("1.0/cancel_job",t)}}}function h(e){return{runAfter:async(t,r,s)=>{let n={requestId:e,...d(t,r,s)};return await (0,o.performAsyncSyscall)("1.0/actions/schedule",n)},runAt:async(t,r,s)=>{let n={requestId:e,...p(t,r,s)};return await (0,o.performAsyncSyscall)("1.0/actions/schedule",n)},cancel:async e=>{(0,l.validateArg)(e,1,"cancel","id");let t={id:(0,n.convexToJson)(e)};return await (0,o.performAsyncSyscall)("1.0/actions/cancel_job",t)}}}function d(e,t,r){if("number"!=typeof e)throw Error("`delayMs` must be a number");if(!isFinite(e))throw Error("`delayMs` must be a finite number");if(e<0)throw Error("`delayMs` must be non-negative");let s=(0,a.parseArgs)(r),o=(0,u.getFunctionAddress)(t),l=(Date.now()+e)/1e3;return{...o,ts:l,args:(0,n.convexToJson)(s),version:i.version}}function p(e,t,r){let s;if(e instanceof Date)s=e.valueOf()/1e3;else if("number"==typeof e)s=e/1e3;else throw Error("The invoke time must a Date or a timestamp");let o=(0,u.getFunctionAddress)(t),l=(0,a.parseArgs)(r);return{...o,ts:s,args:(0,n.convexToJson)(l),version:i.version}}},{"../../values/index.js":"dViyc","../../index.js":"dF102","./syscall.js":"jJbDX","../../common/index.js":"l8P8A","./validate.js":"9fisJ","../components/paths.js":"5wHBq","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],"5f89n":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"setupStorageReader",()=>a),s.export(r,"setupStorageWriter",()=>l),s.export(r,"setupStorageActionWriter",()=>u);var n=e("../../index.js"),i=e("./syscall.js"),o=e("./validate.js");function a(e){return{getUrl:async t=>((0,o.validateArg)(t,1,"getUrl","storageId"),await (0,i.performAsyncSyscall)("1.0/storageGetUrl",{requestId:e,version:n.version,storageId:t})),getMetadata:async t=>await (0,i.performAsyncSyscall)("1.0/storageGetMetadata",{requestId:e,version:n.version,storageId:t})}}function l(e){let t=a(e);return{generateUploadUrl:async()=>await (0,i.performAsyncSyscall)("1.0/storageGenerateUploadUrl",{requestId:e,version:n.version}),delete:async t=>{await (0,i.performAsyncSyscall)("1.0/storageDelete",{requestId:e,version:n.version,storageId:t})},getUrl:t.getUrl,getMetadata:t.getMetadata}}function u(e){let t=l(e);return{...t,store:async(t,r)=>await (0,i.performJsSyscall)("storage/storeBlob",{requestId:e,version:n.version,blob:t,options:r}),get:async t=>await (0,i.performJsSyscall)("storage/getBlob",{requestId:e,version:n.version,storageId:t})}}},{"../../index.js":"dF102","./syscall.js":"jJbDX","./validate.js":"9fisJ","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],iF7Id:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"paginationOptsValidator",()=>i),s.export(r,"paginationResultValidator",()=>o);var n=e("../values/validator.js");let i=(0,n.v).object({numItems:(0,n.v).number(),cursor:(0,n.v).union((0,n.v).string(),(0,n.v).null()),endCursor:(0,n.v).optional((0,n.v).union((0,n.v).string(),(0,n.v).null())),id:(0,n.v).optional((0,n.v).number()),maximumRowsRead:(0,n.v).optional((0,n.v).number()),maximumBytesRead:(0,n.v).optional((0,n.v).number())});function o(e){return(0,n.v).object({page:(0,n.v).array(e),continueCursor:(0,n.v).string(),isDone:(0,n.v).boolean(),splitCursor:(0,n.v).optional((0,n.v).union((0,n.v).string(),(0,n.v).null())),pageStatus:(0,n.v).optional((0,n.v).union((0,n.v).literal("SplitRecommended"),(0,n.v).literal("SplitRequired"),(0,n.v).null()))})}},{"../values/validator.js":"b5eX5","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],"8w2vI":[function(e,t,r){},{}],"9tfnN":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"cronJobs",()=>h),s.export(r,"Crons",()=>g);var n=e("../server/api.js"),i=e("../common/index.js"),o=e("../values/index.js"),a=Object.defineProperty,l=(e,t,r)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,u=(e,t,r)=>l(e,"symbol"!=typeof t?t+"":t,r);let c=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],h=()=>new g;function d(e){if(!Number.isInteger(e)||e<=0)throw Error("Interval must be an integer greater than 0")}function p(e){if(!Number.isInteger(e)||e<0||e>23)throw Error("Hour of day must be an integer from 0 to 23");return e}function f(e){if(!Number.isInteger(e)||e<0||e>59)throw Error("Minute of hour must be an integer from 0 to 59");return e}class g{constructor(){u(this,"crons"),u(this,"isCrons"),this.isCrons=!0,this.crons={}}schedule(e,t,r,s){let a=(0,i.parseArgs)(s);if(function(e){if(!e.match(/^[ -~]*$/))throw Error(`Invalid cron identifier ${e}: use ASCII letters that are not control characters`)}(e),e in this.crons)throw Error(`Cron identifier registered twice: ${e}`);this.crons[e]={name:(0,n.getFunctionName)(r),args:[(0,o.convexToJson)(a)],schedule:t}}interval(e,t,r,...s){let n=+("seconds"in t&&void 0!==t.seconds),i=+("minutes"in t&&void 0!==t.minutes),o=+("hours"in t&&void 0!==t.hours);if(1!==n+i+o)throw Error("Must specify one of seconds, minutes, or hours");n?d(t.seconds):i?d(t.minutes):o&&d(t.hours),this.schedule(e,{...t,type:"interval"},r,...s)}hourly(e,t,r,...s){let n=f(t.minuteUTC);this.schedule(e,{minuteUTC:n,type:"hourly"},r,...s)}daily(e,t,r,...s){let n=p(t.hourUTC),i=f(t.minuteUTC);this.schedule(e,{hourUTC:n,minuteUTC:i,type:"daily"},r,...s)}weekly(e,t,r,...s){let n=function(e){if(!c.includes(e))throw Error('Day of week must be a string like "monday".');return e}(t.dayOfWeek),i=p(t.hourUTC),o=f(t.minuteUTC);this.schedule(e,{dayOfWeek:n,hourUTC:i,minuteUTC:o,type:"weekly"},r,...s)}monthly(e,t,r,...s){let n=function(e){if(!Number.isInteger(e)||e<1||e>31)throw Error("Day of month must be an integer from 1 to 31");return e}(t.day),i=p(t.hourUTC),o=f(t.minuteUTC);this.schedule(e,{day:n,hourUTC:i,minuteUTC:o,type:"monthly"},r,...s)}cron(e,t,r,...s){this.schedule(e,{cron:t,type:"cron"},r,...s)}export(){return JSON.stringify(this.crons)}}},{"../server/api.js":"cQjid","../common/index.js":"l8P8A","../values/index.js":"dViyc","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],"2xUUi":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"ROUTABLE_HTTP_METHODS",()=>l),s.export(r,"normalizeMethod",()=>u),s.export(r,"httpRouter",()=>c),s.export(r,"HttpRouter",()=>h);var n=e("./impl/syscall.js"),i=Object.defineProperty,o=(e,t,r)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,a=(e,t,r)=>o(e,"symbol"!=typeof t?t+"":t,r);let l=["GET","POST","PUT","DELETE","OPTIONS","PATCH"];function u(e){return"HEAD"===e?"GET":e}let c=()=>new h;class h{constructor(){a(this,"exactRoutes",new Map),a(this,"prefixRoutes",new Map),a(this,"isRouter",!0),a(this,"route",e=>{if(!e.handler)throw Error("route requires handler");if(!e.method)throw Error("route requires method");let{method:t,handler:r}=e;if(!l.includes(t))throw Error(`'${t}' is not an allowed HTTP method (like GET, POST, PUT etc.)`);if("path"in e){if("pathPrefix"in e)throw Error("Invalid httpRouter route: cannot contain both 'path' and 'pathPrefix'");if(!e.path.startsWith("/"))throw Error(`path '${e.path}' does not start with a /`);if(e.path.startsWith("/.files/")||"/.files"===e.path)throw Error(`path '${e.path}' is reserved`);let s=this.exactRoutes.has(e.path)?this.exactRoutes.get(e.path):new Map;if(s.has(t))throw Error(`Path '${e.path}' for method ${t} already in use`);s.set(t,r),this.exactRoutes.set(e.path,s)}else if("pathPrefix"in e){if(!e.pathPrefix.startsWith("/"))throw Error(`pathPrefix '${e.pathPrefix}' does not start with a /`);if(!e.pathPrefix.endsWith("/"))throw Error(`pathPrefix ${e.pathPrefix} must end with a /`);if(e.pathPrefix.startsWith("/.files/"))throw Error(`pathPrefix '${e.pathPrefix}' is reserved`);let s=this.prefixRoutes.get(t)||new Map;if(s.has(e.pathPrefix))throw Error(`${e.method} pathPrefix ${e.pathPrefix} is already defined`);s.set(e.pathPrefix,r),this.prefixRoutes.set(t,s)}else throw Error("Invalid httpRouter route entry: must contain either field 'path' or 'pathPrefix'")}),a(this,"getRoutes",()=>{let e=[...this.exactRoutes.keys()].sort(),t=e.flatMap(e=>[...this.exactRoutes.get(e).keys()].sort().map(t=>[e,t,this.exactRoutes.get(e).get(t)])),r=[...this.prefixRoutes.keys()].sort(),s=r.flatMap(e=>[...this.prefixRoutes.get(e).keys()].sort().map(t=>[`${t}*`,e,this.prefixRoutes.get(e).get(t)]));return[...t,...s]}),a(this,"lookup",(e,t)=>{t=u(t);let r=this.exactRoutes.get(e)?.get(t);if(r)return[r,t,e];let s=this.prefixRoutes.get(t)||new Map,n=[...s.entries()].sort(([e,t],[r,s])=>r.length-e.length);for(let[r,s]of n)if(e.startsWith(r))return[s,t,`${r}*`];return null}),a(this,"runRequest",async(e,t)=>{let r=(0,n.performJsSyscall)("requestFromConvexJson",{convexJson:JSON.parse(e)}),s=t;s&&"string"==typeof s||(s=new URL(r.url).pathname);let i=r.method,o=this.lookup(s,i);if(!o){let e=new Response(`No HttpAction routed for ${s}`,{status:404});return JSON.stringify((0,n.performJsSyscall)("convexJsonFromResponse",{response:e}))}let[a,l,u]=o,c=await a.invokeHttpAction(r);return JSON.stringify((0,n.performJsSyscall)("convexJsonFromResponse",{response:c}))})}}},{"./impl/syscall.js":"jJbDX","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],jGOvp:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"getFunctionAddress",()=>a.getFunctionAddress),s.export(r,"createFunctionHandle",()=>h),s.export(r,"defineComponent",()=>v),s.export(r,"defineApp",()=>b),s.export(r,"currentSystemUdfInComponent",()=>w),s.export(r,"componentsGeneric",()=>x);var n=e("../../values/index.js"),i=e("../../index.js"),o=e("../impl/syscall.js"),a=e("./paths.js"),l=Object.defineProperty,u=(e,t,r)=>t in e?l(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,c=(e,t,r)=>u(e,"symbol"!=typeof t?t+"":t,r);async function h(e){let t=(0,a.getFunctionAddress)(e);return await (0,o.performAsyncSyscall)("1.0/createFunctionHandle",{...t,version:i.version})}class d{constructor(e,t){c(this,"_definition"),c(this,"_name"),this._definition=e,this._name=t,(0,a.setReferencePath)(this,`_reference/childComponent/${t}`)}get exports(){return function e(t,r){return new Proxy({},{get(s,n){if("string"==typeof n){let s=[...r,n];return e(t,s)}if(n===a.toReferencePath){let e=`_reference/childComponent/${t}`;for(let t of r)e+=`/${t}`;return e}}})}(this._name,[])}}function p(e,t){if("string"!=typeof e.componentDefinitionPath)throw Error("Component definition does not have the required componentDefinitionPath property. This code only works in Convex runtime.");let r=t?.name||e.defaultName||e.componentDefinitionPath.split("/").pop();return this._childComponents.push([r,e,{}]),new d(e,r)}function f(){let e=m(this._childComponents);return{definitionType:{type:"app"},childComponents:e,httpMounts:{},exports:g(this._exportTree)}}function g(e){let t=[];for(let[r,s]of Object.entries(e)){let e;e="string"==typeof s?{type:"leaf",leaf:s}:g(s),t.push([r,e])}return{type:"branch",branch:t}}function m(e){return e.map(([e,t,r])=>{let s=null;if(null!==r)for(let[e,t]of(s=[],Object.entries(r)))void 0!==t&&s.push([e,{type:"value",value:JSON.stringify((0,n.convexToJson)(t))}]);let i=t.componentDefinitionPath;if(!i)throw Error("no .componentPath for component definition "+JSON.stringify(t,null,2));return{name:e,path:i,args:s}})}function y(){let e=Object.entries(this._args).map(([e,t])=>[e,{type:"value",value:JSON.stringify(t.json)}]),t={type:"childComponent",name:this._name,args:e},r=m(this._childComponents);return{name:this._name,definitionType:t,childComponents:r,httpMounts:{},exports:g(this._exportTree)}}function v(e){return{_isRoot:!1,_name:e,_args:{},_childComponents:[],_exportTree:{},_onInitCallbacks:{},export:y,use:p}}function b(){return{_isRoot:!0,_childComponents:[],_exportTree:{},export:f,use:p}}function w(e){return{[a.toReferencePath]:`_reference/currentSystemUdfInComponent/${e}`}}let x=()=>(function e(t,r){return new Proxy({},{get(s,n){if("string"==typeof n){let s=[...r,n];return e(t,s)}if(n===a.toReferencePath){if(r.length<1){let e=[t,...r].join(".");throw Error(`API path is expected to be of the form \`${t}.childComponent.functionName\`. Found: \`${e}\``)}return"_reference/childComponent/"+r.join("/")}}})})("components",[])},{"../../values/index.js":"dViyc","../../index.js":"dF102","../impl/syscall.js":"jJbDX","./paths.js":"5wHBq","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],"2T9ge":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"TableDefinition",()=>l),s.export(r,"defineTable",()=>u),s.export(r,"SchemaDefinition",()=>c),s.export(r,"defineSchema",()=>h);var n=e("../values/validator.js"),i=Object.defineProperty,o=(e,t,r)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,a=(e,t,r)=>o(e,"symbol"!=typeof t?t+"":t,r);class l{constructor(e){a(this,"indexes"),a(this,"stagedDbIndexes"),a(this,"searchIndexes"),a(this,"stagedSearchIndexes"),a(this,"vectorIndexes"),a(this,"stagedVectorIndexes"),a(this,"validator"),this.indexes=[],this.stagedDbIndexes=[],this.searchIndexes=[],this.stagedSearchIndexes=[],this.vectorIndexes=[],this.stagedVectorIndexes=[],this.validator=e}" indexes"(){return this.indexes}index(e,t){return Array.isArray(t)?this.indexes.push({indexDescriptor:e,fields:t}):t.staged?this.stagedDbIndexes.push({indexDescriptor:e,fields:t.fields}):this.indexes.push({indexDescriptor:e,fields:t.fields}),this}searchIndex(e,t){return t.staged?this.stagedSearchIndexes.push({indexDescriptor:e,searchField:t.searchField,filterFields:t.filterFields||[]}):this.searchIndexes.push({indexDescriptor:e,searchField:t.searchField,filterFields:t.filterFields||[]}),this}vectorIndex(e,t){return t.staged?this.stagedVectorIndexes.push({indexDescriptor:e,vectorField:t.vectorField,dimensions:t.dimensions,filterFields:t.filterFields||[]}):this.vectorIndexes.push({indexDescriptor:e,vectorField:t.vectorField,dimensions:t.dimensions,filterFields:t.filterFields||[]}),this}self(){return this}export(){let e=this.validator.json;if("object"!=typeof e)throw Error("Invalid validator: please make sure that the parameter of `defineTable` is valid (see https://docs.convex.dev/database/schemas)");return{indexes:this.indexes,stagedDbIndexes:this.stagedDbIndexes,searchIndexes:this.searchIndexes,stagedSearchIndexes:this.stagedSearchIndexes,vectorIndexes:this.vectorIndexes,stagedVectorIndexes:this.stagedVectorIndexes,documentType:e}}}function u(e){return new l((0,n.isValidator)(e)?e:(0,n.v).object(e))}class c{constructor(e,t){a(this,"tables"),a(this,"strictTableNameTypes"),a(this,"schemaValidation"),this.tables=e,this.schemaValidation=t?.schemaValidation===void 0||t.schemaValidation}export(){return JSON.stringify({tables:Object.entries(this.tables).map(([e,t])=>{let{indexes:r,stagedDbIndexes:s,searchIndexes:n,stagedSearchIndexes:i,vectorIndexes:o,stagedVectorIndexes:a,documentType:l}=t.export();return{tableName:e,indexes:r,stagedDbIndexes:s,searchIndexes:n,stagedSearchIndexes:i,vectorIndexes:o,stagedVectorIndexes:a,documentType:l}}),schemaValidation:this.schemaValidation})}}function h(e,t){return new c(e,t)}h({_scheduled_functions:u({name:(0,n.v).string(),args:(0,n.v).array((0,n.v).any()),scheduledTime:(0,n.v).float64(),completedTime:(0,n.v).optional((0,n.v).float64()),state:(0,n.v).union((0,n.v).object({kind:(0,n.v).literal("pending")}),(0,n.v).object({kind:(0,n.v).literal("inProgress")}),(0,n.v).object({kind:(0,n.v).literal("success")}),(0,n.v).object({kind:(0,n.v).literal("failed"),error:(0,n.v).string()}),(0,n.v).object({kind:(0,n.v).literal("canceled")}))}),_storage:u({sha256:(0,n.v).string(),size:(0,n.v).float64(),contentType:(0,n.v).optional((0,n.v).string())})})},{"../values/validator.js":"b5eX5","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}]},["kgW6q"],"kgW6q","parcelRequire1e2a"),globalThis.define=t;